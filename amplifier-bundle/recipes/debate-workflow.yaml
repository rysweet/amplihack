name: "debate-workflow"
description: "Multi-agent structured debate for complex decisions requiring diverse perspectives"
version: "2.0.0"
author: "Amplihack Team"
tags: ["debate", "decision", "consensus", "multi-agent", "architecture"]

# DEBATE_WORKFLOW: Multi-Perspective Decision Making
#
# Implements structured multi-perspective debate for important architectural decisions,
# design trade-offs, and complex problems where multiple valid approaches exist.
#
# WHEN TO USE:
#   - Major architectural decisions (framework selection, system design)
#   - Complex trade-offs with no clear winner
#   - Controversial changes affecting multiple teams
#   - High-impact decisions requiring buy-in
#   - When perspectives genuinely conflict
#
# WHEN NOT TO USE:
#   - Simple implementation choices
#   - Decisions with obvious correct answer
#   - Time-sensitive hot fixes
#   - Minor refactoring
#   - Routine feature additions
#
# PHASES (8 Steps):
#   1. Frame the Decision - Define question, constraints, criteria
#   2. Initialize Perspectives - Spawn specialized agents for each viewpoint
#   3. Debate Round 1 - Independent position formation
#   4. Debate Round 2 - Challenge and cross-examination
#   5. Debate Round 3 - Find common ground and hybrid approaches
#   6. Facilitator Synthesis - Neutral synthesis and recommendation
#   7. Decision Documentation - Create decision record
#   8. Implementation - Execute the decided approach
#
# INTEGRATION WITH DEFAULT_WORKFLOW:
#   This workflow replaces Step 4 (Research and Design) of DEFAULT_WORKFLOW
#   when complex decisions require multi-perspective analysis.
#   After completion, proceed with DEFAULT_WORKFLOW Step 5 (Implementation).
#
# PERSPECTIVE PROFILES (7 available):
#   - security:      Vulnerabilities, attack vectors, data protection
#   - performance:   Speed, scalability, resource efficiency
#   - simplicity:    Minimal complexity, ruthless simplification
#   - maintainability: Long-term evolution, technical debt
#   - ux:            API design, usability, developer experience
#   - scalability:   Growth capacity, distributed systems
#   - cost:          Resource usage, infrastructure costs, development time
#
# CONVERGENCE CRITERIA:
#   - unanimous:  100% agreement required (all perspectives agree)
#   - majority:   2/3 agreement required (two-thirds rule)
#   - synthesis:  Facilitator synthesizes best hybrid approach
#   - evidence:   Follow strongest evidence/arguments
#
# Usage:
#   amplifier recipes execute debate-workflow.yaml --context '{
#     "decision_question": "Should we use PostgreSQL or MongoDB for user analytics?",
#     "decision_context": "10M events/day expected, need complex queries for dashboards",
#     "constraints": "Budget $5K/month, team familiar with PostgreSQL",
#     "perspectives": "performance,simplicity,cost,scalability",
#     "debate_rounds": "3",
#     "convergence": "synthesis"
#   }'

recursion:
  max_depth: 4
  max_total_steps: 50

context:
  # ==========================================================================
  # REQUIRED INPUTS
  # ==========================================================================

  # The decision question to debate (frame as question, not predetermined answer)
  decision_question: ""

  # Context: why this decision matters, background information
  decision_context: ""

  # Non-negotiable constraints and technical limitations
  constraints: ""

  # ==========================================================================
  # CONFIGURATION OPTIONS
  # ==========================================================================

  # Perspectives to include (comma-separated)
  # Options: security, performance, simplicity, maintainability, ux, scalability, cost
  # Default: 3 perspectives (security, performance, simplicity)
  # Extended (5): security, performance, simplicity, maintainability, ux
  # Comprehensive (7): all seven perspectives
  perspectives: "security,performance,simplicity"

  # Number of debate rounds (2-4)
  # 2 = Quick (position + challenge)
  # 3 = Standard (position + challenge + synthesis) [DEFAULT]
  # 4-5 = Deep (multiple challenge/response cycles)
  debate_rounds: "3"

  # Convergence criteria: unanimous, majority, synthesis, evidence
  # unanimous = 100% Strong consensus (all perspectives agree)
  # majority = 2/3 majority rule
  # synthesis = Facilitator synthesizes best hybrid [DEFAULT]
  # evidence = Follow strongest evidence/arguments
  convergence: "synthesis"

  # Working directory for decision records
  working_dir: "./decisions"

  # ==========================================================================
  # INTERNAL STATE (populated during execution)
  # ==========================================================================
  security_perspective: ""
  ux_perspective: ""
  scalability_perspective: ""
  cost_perspective: ""
  round2_challenges: ""
  round3_common_ground: ""
  implementation_result: ""

steps:
  # ==========================================================================
  # STEP 1: FRAME THE DECISION
  # Use ambiguity agent to clarify + prompt-writer for clear decision prompt
  # ==========================================================================
  - id: "frame-decision"
    agent: "amplihack:ambiguity"
    prompt: |
      Frame this decision for structured multi-perspective debate:

      **Question:** {{decision_question}}
      **Context:** {{decision_context}}
      **Constraints:** {{constraints}}
      **Perspectives to include:** {{perspectives}}

      **CRITICAL: Frame the decision as a QUESTION, not a predetermined answer.**

      Your task:
      1. Clarify any ambiguities in the decision question
      2. Identify stakeholder concerns
      3. List evaluation criteria
      4. Document explicit user requirements that constrain options

      Create a decision framing document as JSON:
      ```json
      {
        "title": "Brief decision title",
        "question": "One-sentence question to be debated",
        "context": "Why this decision matters, background information",
        "constraints": ["Non-negotiable requirements", "Technical limitations"],
        "evaluation_criteria": [
          {"criterion": "name", "weight": "high/medium/low", "description": "how to judge"}
        ],
        "options_to_consider": ["Known options to evaluate"],
        "perspectives_needed": ["List of perspectives from input"],
        "out_of_scope": ["What this decision does NOT cover"],
        "stakeholder_concerns": ["Key concerns from different stakeholders"]
      }
      ```
    output: "framing_draft"
    parse_json: true
    timeout: 120

  - id: "refine-decision-prompt"
    agent: "amplihack:prompt-writer"
    prompt: |
      Refine the decision framing into a clear, unambiguous prompt for debate:

      **Draft Framing:**
      {{framing_draft}}

      Create the final decision framing that will be shared with all perspective agents:

      ```json
      {
        "title": "{{framing_draft.title}}",
        "question": "Refined one-sentence question - clear and unambiguous",
        "context": "{{framing_draft.context}}",
        "constraints": {{framing_draft.constraints}},
        "evaluation_criteria": {{framing_draft.evaluation_criteria}},
        "options_to_consider": {{framing_draft.options_to_consider}},
        "perspectives_needed": {{framing_draft.perspectives_needed}},
        "out_of_scope": {{framing_draft.out_of_scope}},
        "debate_format": {
          "rounds": {{debate_rounds}},
          "convergence_criteria": "{{convergence}}",
          "round_1": "Independent position formation",
          "round_2": "Challenge and cross-examination",
          "round_3": "Find common ground and hybrid approaches"
        }
      }
      ```

      Ensure the question is:
      - Framed neutrally (not leading toward any option)
      - Specific enough to be actionable
      - Scoped appropriately given constraints
    output: "framing"
    parse_json: true
    timeout: 90

  # ==========================================================================
  # STEP 2: INITIALIZE PERSPECTIVES (Parallel Subprocess Execution)
  # Each perspective forms initial position INDEPENDENTLY - no context sharing
  # ==========================================================================

  # PERSPECTIVE 1: SECURITY
  - id: "perspective-security"
    agent: "amplihack:security"
    prompt: |
      **SECURITY PERSPECTIVE ANALYSIS**

      Analyze this decision from a SECURITY perspective:

      **Decision:** {{framing.question}}
      **Context:** {{framing.context}}
      **Constraints:** {{framing.constraints}}
      **Options to Consider:** {{framing.options_to_consider}}
      **Evaluation Criteria:** {{framing.evaluation_criteria}}

      As the Security advocate, your focus areas:
      - Vulnerabilities and attack vectors
      - Data protection and privacy
      - Authentication and authorization implications
      - Compliance and regulatory requirements
      - Security maintenance burden

      Key questions to answer:
      - "What could go wrong?"
      - "How do we prevent breaches?"
      - "What are the security implications of each option?"

      Provide your INDEPENDENT analysis (no knowledge of other perspectives):

      ```json
      {
        "perspective": "security",
        "recommendation": "Your recommended option",
        "arguments": [
          {"point": "Security argument 1", "evidence": "Supporting data or examples"},
          {"point": "Security argument 2", "evidence": "Supporting data or examples"},
          {"point": "Security argument 3", "evidence": "Supporting data or examples"}
        ],
        "concerns_about_alternatives": [
          {"option": "Alternative option", "concern": "Specific security concern"}
        ],
        "risks_if_ignored": ["What happens if security concerns are overruled"],
        "assumptions": ["Security assumptions you're making"],
        "confidence": "high/medium/low",
        "non_negotiables": ["Security requirements that cannot be compromised"]
      }
      ```
    output: "security_perspective"
    parse_json: true
    timeout: 120

  # PERSPECTIVE 2: PERFORMANCE
  - id: "perspective-performance"
    agent: "amplihack:optimizer"
    prompt: |
      **PERFORMANCE PERSPECTIVE ANALYSIS**

      Analyze this decision from a PERFORMANCE perspective:

      **Decision:** {{framing.question}}
      **Context:** {{framing.context}}
      **Constraints:** {{framing.constraints}}
      **Options to Consider:** {{framing.options_to_consider}}
      **Evaluation Criteria:** {{framing.evaluation_criteria}}

      As the Performance advocate, your focus areas:
      - Speed and latency
      - Throughput and scalability
      - Resource efficiency (CPU, memory, I/O)
      - Bottleneck identification
      - Performance at scale (10x, 100x load)

      Key questions to answer:
      - "Will this scale?"
      - "What are the bottlenecks?"
      - "What happens at 10x load? 100x?"

      Provide your INDEPENDENT analysis (no knowledge of other perspectives):

      ```json
      {
        "perspective": "performance",
        "recommendation": "Your recommended option",
        "arguments": [
          {"point": "Performance argument 1", "evidence": "Benchmarks, data, or examples"},
          {"point": "Performance argument 2", "evidence": "Benchmarks, data, or examples"},
          {"point": "Performance argument 3", "evidence": "Benchmarks, data, or examples"}
        ],
        "concerns_about_alternatives": [
          {"option": "Alternative option", "concern": "Specific performance concern"}
        ],
        "scaling_analysis": {
          "current_load": "Performance at current requirements",
          "10x_load": "Expected behavior at 10x scale",
          "100x_load": "Expected behavior at 100x scale"
        },
        "assumptions": ["Performance assumptions you're making"],
        "confidence": "high/medium/low",
        "benchmarks_needed": ["What benchmarks would validate this recommendation"]
      }
      ```
    output: "perf_perspective"
    parse_json: true
    timeout: 120

  # PERSPECTIVE 3: SIMPLICITY
  - id: "perspective-simplicity"
    agent: "amplihack:cleanup"
    prompt: |
      **SIMPLICITY PERSPECTIVE ANALYSIS**

      Analyze this decision from a SIMPLICITY perspective:

      **Decision:** {{framing.question}}
      **Context:** {{framing.context}}
      **Constraints:** {{framing.constraints}}
      **Options to Consider:** {{framing.options_to_consider}}
      **Evaluation Criteria:** {{framing.evaluation_criteria}}

      As the Simplicity advocate, your focus areas:
      - Minimal complexity
      - Ruthless simplification
      - Fewer moving parts
      - Ease of understanding
      - Reduced cognitive load

      Key questions to answer:
      - "Is this the simplest solution?"
      - "Can we remove abstractions?"
      - "What can be eliminated without losing essential functionality?"

      Provide your INDEPENDENT analysis (no knowledge of other perspectives):

      ```json
      {
        "perspective": "simplicity",
        "recommendation": "Your recommended option (the simplest one)",
        "arguments": [
          {"point": "Simplicity argument 1", "evidence": "Supporting reasoning"},
          {"point": "Simplicity argument 2", "evidence": "Supporting reasoning"},
          {"point": "Simplicity argument 3", "evidence": "Supporting reasoning"}
        ],
        "concerns_about_alternatives": [
          {"option": "Alternative option", "concern": "Why it's too complex"}
        ],
        "complexity_comparison": {
          "option_name": {"components": 0, "dependencies": 0, "learning_curve": "low/medium/high"}
        },
        "what_can_be_removed": ["Unnecessary elements in complex options"],
        "assumptions": ["Simplicity assumptions you're making"],
        "confidence": "high/medium/low",
        "simplification_opportunities": ["Ways to simplify any option"]
      }
      ```
    output: "simplicity_perspective"
    parse_json: true
    timeout: 120

  # PERSPECTIVE 4: MAINTAINABILITY
  - id: "perspective-maintainability"
    agent: "amplihack:reviewer"
    prompt: |
      **MAINTAINABILITY PERSPECTIVE ANALYSIS**

      Analyze this decision from a MAINTAINABILITY perspective:

      **Decision:** {{framing.question}}
      **Context:** {{framing.context}}
      **Constraints:** {{framing.constraints}}
      **Options to Consider:** {{framing.options_to_consider}}
      **Evaluation Criteria:** {{framing.evaluation_criteria}}

      As the Maintainability advocate, your focus areas:
      - Long-term evolution and extensibility
      - Technical debt implications
      - Team expertise and learning curve
      - Documentation requirements
      - Debugging and troubleshooting ease
      - Upgrade and migration paths

      Key questions to answer:
      - "Can future developers understand this?"
      - "How hard is it to change?"
      - "What's the technical debt impact?"

      Provide your INDEPENDENT analysis (no knowledge of other perspectives):

      ```json
      {
        "perspective": "maintainability",
        "recommendation": "Your recommended option",
        "arguments": [
          {"point": "Maintainability argument 1", "evidence": "Supporting reasoning"},
          {"point": "Maintainability argument 2", "evidence": "Supporting reasoning"},
          {"point": "Maintainability argument 3", "evidence": "Supporting reasoning"}
        ],
        "concerns_about_alternatives": [
          {"option": "Alternative option", "concern": "Maintainability concern"}
        ],
        "team_impact": {
          "learning_curve": "Estimated time to proficiency",
          "existing_expertise": "Team's current knowledge",
          "documentation_needs": "What documentation is required"
        },
        "technical_debt_analysis": ["Long-term debt implications of each option"],
        "assumptions": ["Maintainability assumptions you're making"],
        "confidence": "high/medium/low",
        "migration_complexity": "How hard to change this decision later"
      }
      ```
    output: "maintain_perspective"
    parse_json: true
    timeout: 120

  # PERSPECTIVE 5: USER EXPERIENCE
  - id: "perspective-ux"
    agent: "amplihack:api-designer"
    prompt: |
      **USER EXPERIENCE PERSPECTIVE ANALYSIS**

      Analyze this decision from a USER EXPERIENCE perspective:

      **Decision:** {{framing.question}}
      **Context:** {{framing.context}}
      **Constraints:** {{framing.constraints}}
      **Options to Consider:** {{framing.options_to_consider}}
      **Evaluation Criteria:** {{framing.evaluation_criteria}}

      As the User Experience advocate, your focus areas:
      - API design and usability
      - Developer experience (DX)
      - End-user experience
      - Intuitiveness and discoverability
      - Error messages and feedback
      - Documentation and examples

      Key questions to answer:
      - "Is this intuitive?"
      - "How will users interact with this?"
      - "What's the developer experience like?"

      Provide your INDEPENDENT analysis (no knowledge of other perspectives):

      ```json
      {
        "perspective": "ux",
        "recommendation": "Your recommended option",
        "arguments": [
          {"point": "UX argument 1", "evidence": "User impact or DX consideration"},
          {"point": "UX argument 2", "evidence": "User impact or DX consideration"},
          {"point": "UX argument 3", "evidence": "User impact or DX consideration"}
        ],
        "concerns_about_alternatives": [
          {"option": "Alternative option", "concern": "UX/DX concern"}
        ],
        "user_journey_impact": {
          "learning_curve": "How easy to get started",
          "daily_usage": "Experience for regular use",
          "edge_cases": "Handling of unusual scenarios"
        },
        "assumptions": ["UX assumptions you're making"],
        "confidence": "high/medium/low",
        "ux_improvements": ["Ways to improve UX regardless of choice"]
      }
      ```
    output: "ux_perspective"
    parse_json: true
    timeout: 120

  # PERSPECTIVE 6: SCALABILITY
  - id: "perspective-scalability"
    agent: "amplihack:architect"
    prompt: |
      **SCALABILITY PERSPECTIVE ANALYSIS**

      Analyze this decision from a SCALABILITY perspective:

      **Decision:** {{framing.question}}
      **Context:** {{framing.context}}
      **Constraints:** {{framing.constraints}}
      **Options to Consider:** {{framing.options_to_consider}}
      **Evaluation Criteria:** {{framing.evaluation_criteria}}

      As the Scalability advocate, your focus areas:
      - Growth capacity and horizontal scaling
      - Distributed systems considerations
      - Data partitioning and sharding
      - Geographic distribution
      - Load balancing and failover
      - Resource elasticity

      Key questions to answer:
      - "What happens at 10x load? 100x? 1000x?"
      - "How do we scale horizontally?"
      - "What are the scaling bottlenecks?"

      Provide your INDEPENDENT analysis (no knowledge of other perspectives):

      ```json
      {
        "perspective": "scalability",
        "recommendation": "Your recommended option",
        "arguments": [
          {"point": "Scalability argument 1", "evidence": "Scaling data or examples"},
          {"point": "Scalability argument 2", "evidence": "Scaling data or examples"},
          {"point": "Scalability argument 3", "evidence": "Scaling data or examples"}
        ],
        "concerns_about_alternatives": [
          {"option": "Alternative option", "concern": "Scalability limitation"}
        ],
        "scaling_strategy": {
          "horizontal": "How to add more instances",
          "vertical": "Limits of scaling up",
          "data_partitioning": "How to shard/partition data",
          "geographic": "Multi-region considerations"
        },
        "bottleneck_analysis": ["Where scaling will hit limits first"],
        "assumptions": ["Scalability assumptions you're making"],
        "confidence": "high/medium/low",
        "scaling_triggers": ["When to implement scaling improvements"]
      }
      ```
    output: "scalability_perspective"
    parse_json: true
    timeout: 120

  # PERSPECTIVE 7: COST
  - id: "perspective-cost"
    agent: "amplihack:architect"
    prompt: |
      **COST PERSPECTIVE ANALYSIS**

      Analyze this decision from a COST perspective:

      **Decision:** {{framing.question}}
      **Context:** {{framing.context}}
      **Constraints:** {{framing.constraints}}
      **Options to Consider:** {{framing.options_to_consider}}
      **Evaluation Criteria:** {{framing.evaluation_criteria}}

      As the Cost advocate, your focus areas:
      - Infrastructure costs
      - Development time and effort
      - Operational costs (maintenance, monitoring)
      - Licensing and subscription costs
      - Opportunity costs
      - Total Cost of Ownership (TCO)

      Key questions to answer:
      - "What's the ROI?"
      - "Are we over-engineering?"
      - "What are the hidden costs?"

      Provide your INDEPENDENT analysis (no knowledge of other perspectives):

      ```json
      {
        "perspective": "cost",
        "recommendation": "Your recommended option",
        "arguments": [
          {"point": "Cost argument 1", "evidence": "Cost data or estimates"},
          {"point": "Cost argument 2", "evidence": "Cost data or estimates"},
          {"point": "Cost argument 3", "evidence": "Cost data or estimates"}
        ],
        "concerns_about_alternatives": [
          {"option": "Alternative option", "concern": "Cost concern"}
        ],
        "cost_comparison": {
          "option_name": {
            "initial_cost": "Upfront investment",
            "monthly_cost": "Ongoing costs",
            "scaling_cost": "Cost at 10x scale",
            "hidden_costs": ["Often overlooked expenses"]
          }
        },
        "roi_analysis": "Return on investment assessment",
        "assumptions": ["Cost assumptions you're making"],
        "confidence": "high/medium/low",
        "cost_optimization": ["Ways to reduce costs for any option"]
      }
      ```
    output: "cost_perspective"
    parse_json: true
    timeout: 120

  # ==========================================================================
  # STEP 3: DEBATE ROUND 1 - INITIAL POSITIONS
  # Collect and synthesize all initial positions
  # ==========================================================================
  - id: "round1-synthesis"
    agent: "amplihack:architect"
    prompt: |
      **DEBATE ROUND 1: INITIAL POSITIONS SYNTHESIS**

      Synthesize the initial positions from all perspectives:

      **Decision:** {{framing.question}}

      **PERSPECTIVE POSITIONS:**

      **Security Perspective:**
      {{security_perspective}}

      **Performance Perspective:**
      {{perf_perspective}}

      **Simplicity Perspective:**
      {{simplicity_perspective}}

      **Maintainability Perspective:**
      {{maintain_perspective}}

      **User Experience Perspective:**
      {{ux_perspective}}

      **Scalability Perspective:**
      {{scalability_perspective}}

      **Cost Perspective:**
      {{cost_perspective}}

      Analyze and synthesize:

      ```json
      {
        "round": 1,
        "total_perspectives": 7,
        "recommendations_summary": [
          {"perspective": "name", "recommends": "option", "confidence": "level"}
        ],
        "areas_of_agreement": [
          {"point": "What multiple perspectives agree on", "perspectives": ["list"]}
        ],
        "areas_of_conflict": [
          {
            "issue": "The disagreement",
            "positions": {"perspective1": "position", "perspective2": "position"},
            "severity": "high/medium/low"
          }
        ],
        "strongest_arguments": [
          {"perspective": "name", "argument": "Their strongest point", "evidence_quality": "strong/moderate/weak"}
        ],
        "assumptions_to_validate": ["Assumptions made that need verification"],
        "preliminary_consensus": "emerging consensus or 'no consensus'",
        "key_questions_for_round2": ["Questions to explore in challenge round"]
      }
      ```
    output: "round1_synthesis"
    parse_json: true
    timeout: 120

  # ==========================================================================
  # STEP 4: DEBATE ROUND 2 - CHALLENGE AND RESPOND
  # Cross-examination of positions
  # ==========================================================================
  - id: "round2-challenges"
    agent: "amplihack:architect"
    prompt: |
      **DEBATE ROUND 2: CHALLENGE AND CROSS-EXAMINATION**

      Conduct cross-examination where perspectives challenge each other:

      **Decision:** {{framing.question}}
      **Round 1 Synthesis:** {{round1_synthesis}}

      **All Perspectives:**
      - Security: {{security_perspective}}
      - Performance: {{perf_perspective}}
      - Simplicity: {{simplicity_perspective}}
      - Maintainability: {{maintain_perspective}}
      - UX: {{ux_perspective}}
      - Scalability: {{scalability_perspective}}
      - Cost: {{cost_perspective}}

      Generate challenges and responses using this format:

      ```json
      {
        "round": 2,
        "challenges": [
          {
            "challenger": "perspective_name",
            "target": "perspective_name",
            "challenge": "The question or counter-argument",
            "evidence": "Supporting data for the challenge",
            "request": "What would change your position?"
          }
        ],
        "responses": [
          {
            "responder": "perspective_name",
            "to_challenger": "perspective_name",
            "response": "Address the challenge",
            "concession": "Points where they agree or adjust position",
            "counter": "Additional evidence or reasoning"
          }
        ],
        "arguments_that_withstood_scrutiny": [
          {"perspective": "name", "argument": "The argument", "why_strong": "Reason"}
        ],
        "arguments_weakened": [
          {"perspective": "name", "argument": "The argument", "why_weak": "Reason"}
        ],
        "position_shifts": [
          {"perspective": "name", "original": "original position", "updated": "new position", "reason": "why"}
        ],
        "refined_agreements": ["Updated points of consensus"],
        "remaining_conflicts": ["Unresolved disagreements"],
        "evidence_gaps": ["Missing data that would resolve conflicts"]
      }
      ```
    output: "round2_challenges"
    parse_json: true
    timeout: 180

  # ==========================================================================
  # STEP 5: DEBATE ROUND 3 - FIND COMMON GROUND
  # Explicit hybrid approach exploration
  # ==========================================================================
  - id: "round3-common-ground"
    agent: "amplihack:architect"
    prompt: |
      **DEBATE ROUND 3: FIND COMMON GROUND**

      Synthesize common ground and explore hybrid approaches:

      **Decision:** {{framing.question}}
      **Constraints:** {{framing.constraints}}
      **Evaluation Criteria:** {{framing.evaluation_criteria}}

      **Round 1 Synthesis:** {{round1_synthesis}}
      **Round 2 Challenges:** {{round2_challenges}}

      Your task:
      1. Identify points of consensus across ALL perspectives
      2. Surface remaining disagreements explicitly
      3. Explore HYBRID approaches that combine insights from multiple perspectives
      4. Validate hybrid approaches against all perspective concerns

      ```json
      {
        "round": 3,
        "consensus_points": [
          {"point": "What everyone agrees on", "supporting_perspectives": ["list"]}
        ],
        "remaining_disagreements": [
          {
            "issue": "The disagreement",
            "positions": {
              "perspective1": "their stance",
              "perspective2": "their stance"
            },
            "potential_resolution": "Possible compromise"
          }
        ],
        "hybrid_approaches": [
          {
            "name": "Hybrid Option Name",
            "description": "What this hybrid approach entails",
            "combines_from": ["perspectives it draws from"],
            "how_it_works": "Implementation approach",
            "trade_offs": {
              "benefits": ["What we gain"],
              "costs": ["What we give up"]
            },
            "addresses_concerns": {
              "security": "How it addresses security concerns",
              "performance": "How it addresses performance concerns",
              "simplicity": "How it addresses simplicity concerns",
              "maintainability": "How it addresses maintainability concerns",
              "ux": "How it addresses UX concerns",
              "scalability": "How it addresses scalability concerns",
              "cost": "How it addresses cost concerns"
            },
            "risks": ["Remaining risks with this approach"],
            "validation_needed": ["What to test/validate"]
          }
        ],
        "convergence_assessment": {
          "level": "high/medium/low/none",
          "unanimous_support_for": "option or 'none'",
          "majority_support_for": "option or 'none'",
          "strongest_hybrid": "best hybrid approach name"
        },
        "facilitator_notes": "Observations for final synthesis"
      }
      ```
    output: "round3_common_ground"
    parse_json: true
    timeout: 180

  # ==========================================================================
  # STEP 6: FACILITATOR SYNTHESIS
  # Neutral synthesis and recommendation based on convergence criteria
  # ==========================================================================
  - id: "facilitator-synthesis"
    agent: "amplihack:architect"
    prompt: |
      **FACILITATOR SYNTHESIS**

      As a NEUTRAL facilitator, synthesize the entire debate and make a recommendation:

      **Decision:** {{framing.question}}
      **Evaluation Criteria:** {{framing.evaluation_criteria}}
      **Convergence Mode:** {{convergence}}

      **Debate Summary:**
      - Round 1 (Initial Positions): {{round1_synthesis}}
      - Round 2 (Challenges): {{round2_challenges}}
      - Round 3 (Common Ground): {{round3_common_ground}}

      **Apply Convergence Criteria: {{convergence}}**
      - If "unanimous": Recommend ONLY if all perspectives agree, otherwise synthesize
      - If "majority": Recommend option with 2/3+ support
      - If "synthesis": Create best hybrid approach
      - If "evidence": Follow strongest evidence-based arguments

      Provide your synthesis:

      ## Recommendation
      [Clear statement of recommended approach]

      ## Confidence Level
      [High/Medium/Low] based on:
      - Consensus level: [X/7 perspectives support this]
      - Evidence quality: [Strong/Moderate/Weak]
      - Risk level: [Low/Medium/High if wrong]

      ## Rationale
      [Why this recommendation - explain reasoning based on convergence criteria]

      ## Key Arguments That Won
      1. [Argument that swayed decision - with perspective attribution]
      2. [Argument that swayed decision - with perspective attribution]
      3. [Argument that swayed decision - with perspective attribution]

      ## Dissenting Views (Important to Document)
      1. [Strongest counter-argument - perspective and reasoning]
      2. [Remaining concern - perspective and reasoning]

      ## Implementation Guidance
      [Specific steps to execute this decision]

      ## Success Metrics
      [How we'll know if this was the right choice - measurable criteria]

      ## Revisit Triggers
      [Conditions that would require reconsidering this decision]

      ## Risk Mitigation
      [How to address the main risks identified]

      ---

      ```json
      {
        "recommendation": "The recommended approach",
        "recommendation_type": "original_option/hybrid/synthesis",
        "confidence": "high/medium/low",
        "consensus_level": "X/7 perspectives",
        "convergence_method_used": "{{convergence}}",
        "supporting_perspectives": ["list"],
        "dissenting_perspectives": ["list"],
        "key_arguments": ["top 3 arguments"],
        "key_dissents": ["top concerns"],
        "success_metrics": ["measurable criteria"],
        "revisit_triggers": ["conditions to reconsider"],
        "implementation_priority": "immediate/short-term/long-term"
      }
      ```
    output: "synthesis"
    timeout: 180

  # ==========================================================================
  # STEP 7: DECISION DOCUMENTATION
  # Create comprehensive decision record
  # ==========================================================================
  - id: "create-decision-record"
    agent: "amplihack:architect"
    prompt: |
      **CREATE DECISION RECORD**

      Create a comprehensive decision record documenting the entire debate:

      **Decision:** {{framing.question}}
      **Framing:** {{framing}}
      **Synthesis:** {{synthesis}}
      **Round 1:** {{round1_synthesis}}
      **Round 2:** {{round2_challenges}}
      **Round 3:** {{round3_common_ground}}

      Create a decision record following this template:

      # Decision Record: {{framing.title}}

      Date: [TODAY'S DATE]
      Status: Accepted
      Decision Makers: Security, Performance, Simplicity, Maintainability, UX, Scalability, Cost perspectives

      ## Context
      {{framing.context}}

      ## Decision
      [The final decision from synthesis]

      ## Consequences
      [What happens because of this decision - positive and negative]

      ## Alternatives Considered
      [All options that were debated]

      ## Debate Summary

      ### Perspective Positions
      | Perspective | Recommendation | Confidence | Key Argument |
      |-------------|----------------|------------|--------------|
      [Table of all perspective positions]

      ### Key Agreements
      [Points all perspectives agreed on]

      ### Key Conflicts
      [Major disagreements and how they were resolved]

      ## Dissenting Opinions
      [Perspectives that disagreed with final decision and their reasoning]

      ## Success Metrics
      [How to measure if decision was correct]

      ## Review Date
      [When to revisit this decision]

      ## Revisit Triggers
      [Conditions that would require reconsideration]

      ---

      ## Full Debate Transcript

      ### Round 1: Initial Positions
      [Summary of all initial positions]

      ### Round 2: Challenges and Responses
      [Key challenges and responses]

      ### Round 3: Convergence Analysis
      [Common ground and hybrid approaches identified]

      ### Facilitator Synthesis
      [Complete synthesis reasoning]

      ---

      Output the decision record as both markdown AND structured JSON:

      ```json
      {
        "decision_record": {
          "title": "{{framing.title}}",
          "date": "TODAY",
          "status": "Accepted",
          "question": "{{framing.question}}",
          "decision": "Final decision",
          "perspectives_consulted": ["security", "performance", "simplicity", "maintainability", "ux", "scalability", "cost"],
          "convergence_method": "{{convergence}}",
          "consensus_level": "X/7",
          "supporting_perspectives": ["list"],
          "dissenting_perspectives": ["list"],
          "consequences": {
            "positive": ["benefits"],
            "negative": ["drawbacks"],
            "risks": ["risks to monitor"]
          },
          "alternatives_rejected": ["options not chosen"],
          "success_metrics": ["measurable criteria"],
          "review_date": "suggested date",
          "revisit_triggers": ["conditions"]
        }
      }
      ```
    output: "decision_record"
    timeout: 180

  - id: "save-decision-record"
    type: "bash"
    command: |
      set -euo pipefail

      # Create decisions directory if it doesn't exist
      WORKING_DIR='{{working_dir}}'
      mkdir -p "$WORKING_DIR"

      # Generate filename with date
      DATE=$(date +%Y-%m-%d)

      # Sanitize title for filename (extract from framing, use question if not available)
      TITLE='decision'
      FILENAME="${DATE}-${TITLE}.md"
      FILEPATH="$WORKING_DIR/$FILENAME"

      # Write the decision record
      cat << 'DECISION_EOF' > "$FILEPATH"
      {{decision_record}}
      DECISION_EOF

      echo "Decision record saved to: $FILEPATH"
      echo ""
      echo "To add to DISCOVERIES.md, run:"
      echo "  echo '- [$DATE] Decision: {{framing.title}}' >> .claude/context/DISCOVERIES.md"
    output: "save_result"
    timeout: 60

  # ==========================================================================
  # STEP 8: IMPLEMENTATION
  # Execute the decided approach using builder agent
  # ==========================================================================
  - id: "implement-decision"
    agent: "amplihack:builder"
    prompt: |
      **IMPLEMENT THE DECISION**

      Execute the decided approach from the debate:

      **Decision:** {{framing.question}}
      **Recommendation:** {{synthesis}}
      **Decision Record:** {{decision_record}}

      **Implementation Guidance from Synthesis:**
      [Extract implementation steps from synthesis]

      Your task:
      1. Implement the chosen approach following the synthesis guidance
      2. Implement monitoring for success metrics
      3. Set up alerts for revisit triggers
      4. Document the decision in code comments where appropriate
      5. Create runbook if operational complexity is added

      **Implementation Requirements:**
      - Code implementing the decision
      - Tests validating the approach
      - Monitoring for success metrics
      - Documentation for team
      - Contingency plans for revisit triggers

      Provide:

      ## Implementation Summary
      [What was implemented]

      ## Code Changes
      [List of files created/modified with descriptions]

      ## Tests Added
      [Tests that validate the approach]

      ## Monitoring Setup
      [How success metrics are being tracked]

      ## Documentation
      [What documentation was added]

      ## Next Steps
      [Any remaining work or follow-up items]

      ```json
      {
        "implementation_status": "complete/partial/blocked",
        "files_changed": ["list of files"],
        "tests_added": ["list of test files"],
        "monitoring_setup": true/false,
        "documentation_added": true/false,
        "blockers": ["any blockers encountered"],
        "next_steps": ["follow-up items"],
        "ready_for_review": true/false
      }
      ```
    output: "implementation_result"
    timeout: 300

  # ==========================================================================
  # FINAL OUTPUT
  # ==========================================================================
  - id: "final-output"
    type: "bash"
    parse_json: true
    command: |
      cat << 'EOF'
      {
        "workflow": "debate-workflow",
        "version": "2.0.0",
        "decision_question": "{{framing.question}}",
        "phases_completed": [
          "frame-decision",
          "perspective-initialization",
          "round1-initial-positions",
          "round2-challenge-respond",
          "round3-common-ground",
          "facilitator-synthesis",
          "decision-documentation",
          "implementation"
        ],
        "perspectives_consulted": 7,
        "perspective_list": ["security", "performance", "simplicity", "maintainability", "ux", "scalability", "cost"],
        "debate_rounds": {{debate_rounds}},
        "convergence_method": "{{convergence}}",
        "status": "complete",
        "decision_record_location": "{{working_dir}}",
        "integration_note": "This workflow replaced DEFAULT_WORKFLOW Step 4 (Research and Design). Continue with DEFAULT_WORKFLOW Step 5 (Testing) if needed."
      }
      EOF
    output: "final_result"

# ==========================================================================
# WORKFLOW EXECUTION SUMMARY
# ==========================================================================
#
# Phase 1: Decision Framing (Steps 1-2)
#   - amplihack:ambiguity clarifies decision scope
#   - amplihack:prompt-writer creates clear decision prompt
#
# Phase 2: Perspective Initialization (Steps 3-9)
#   - amplihack:security analyzes security implications
#   - amplihack:optimizer analyzes performance implications
#   - amplihack:cleanup analyzes simplicity implications
#   - amplihack:reviewer analyzes maintainability implications
#   - amplihack:api-designer analyzes UX implications
#   - amplihack:architect analyzes scalability implications
#   - amplihack:analyzer analyzes cost implications
#
# Phase 3: Debate Round 1 (Step 10)
#   - amplihack:analyzer synthesizes initial positions
#
# Phase 4: Debate Round 2 (Step 11)
#   - amplihack:analyzer conducts challenge/response
#
# Phase 5: Debate Round 3 (Step 12)
#   - amplihack:architect finds common ground and hybrid approaches
#
# Phase 6: Facilitator Synthesis (Step 13)
#   - amplihack:architect synthesizes final recommendation
#
# Phase 7: Decision Documentation (Steps 14-15)
#   - amplihack:analyzer creates decision record
#   - Bash saves to file
#
# Phase 8: Implementation (Step 16)
#   - amplihack:builder implements the decision
#
# CONVERGENCE CRITERIA:
#   - unanimous: 100% agreement required
#   - majority: 2/3 agreement required
#   - synthesis: Best hybrid approach
#   - evidence: Strongest arguments win
#
# INTEGRATION WITH DEFAULT_WORKFLOW:
#   This workflow replaces Step 4 (Research and Design) when complex
#   decisions require multi-perspective analysis. After completion,
#   continue with DEFAULT_WORKFLOW Step 5 (Implementation/Testing).
