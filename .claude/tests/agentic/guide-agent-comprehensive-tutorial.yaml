# Level 3: Guide Agent - Comprehensive Tutorial Journey
# End-to-end test simulating complete beginner-to-advanced user journey

scenario:
  name: "Guide Agent - Complete Tutorial Journey"
  description: |
    Complete end-to-end test of the tutorial system simulating a user
    progressing from beginner through all 7 sections to advanced mastery.
    Tests full tutorial flow, learning path recommendations, and all features.
  type: cli
  level: 3

  tags: [guide-agent, e2e, comprehensive, full-journey]

  prerequisites:
    - "amplihack installed and configured"
    - "Guide agent v2.0.0 tutorial system"
    - "All documentation cross-references valid"

  environment:
    variables:
      ANTHROPIC_API_KEY: "${ANTHROPIC_API_KEY}"
    timeout_multiplier: 1.5 # Generous timeouts for comprehensive test

  steps:
    # === PHASE 1: Onboarding (Beginner) ===

    - action: launch
      target: "amplihack"
      args: ["claude", "--", "-p", "I want to learn amplihack from scratch. Start the tutorial."]
      description: "Complete beginner starts tutorial"
      timeout: 60s

    - action: wait_for_output
      contains: "Tutorial Overview"
      timeout: 15s
      description: "Should present tutorial overview"

    - action: verify_output
      contains: "60-90 minutes"
      description: "Should state duration"

    - action: verify_output
      contains: "Skill Assessment"
      description: "Should prompt for skill level"

    # Beginner declares level
    - action: send_input
      value: "A - Complete beginner\n"
      description: "User identifies as complete beginner"

    - action: wait_for_output
      matches: "Section 1|Welcome|recommend"
      timeout: 10s
      description: "Should recommend beginner path"

    # === SECTION 1: Welcome & Setup ===

    - action: send_input
      value: "Section 1\n"
      description: "Start with Section 1"

    - action: wait_for_output
      contains: "Welcome & Setup"
      timeout: 15s

    - action: verify_output
      contains: "philosophy"
      description: "Should explain philosophy"

    - action: verify_output
      matches: "ruthless simplicity|modular|zero-BS"
      description: "Should cover core principles"

    - action: verify_output
      matches: "environment|check|setup"
      description: "Should include environment setup"

    # === SECTION 2: First Workflow ===

    - action: send_input
      value: "Continue\n"
      description: "Progress to Section 2"

    - action: wait_for_output
      contains: "First Workflow"
      timeout: 15s

    - action: verify_output
      contains: "22-step"
      description: "Should mention 22-step workflow"

    - action: verify_output
      contains: "DEFAULT_WORKFLOW"
      description: "Should reference default workflow"

    # === SECTION 3: Workflows Deep Dive ===

    - action: send_input
      value: "Continue\n"
      description: "Progress to Section 3"

    - action: wait_for_output
      contains: "Workflows Deep Dive"
      timeout: 15s

    - action: verify_output
      contains: "Q&A"
      description: "Should mention Q&A workflow"

    - action: verify_output
      contains: "INVESTIGATION"
      description: "Should mention investigation workflow"

    - action: verify_output
      matches: "N-version|Debate|Cascade"
      description: "Should cover fault-tolerant workflows"

    - action: verify_output
      contains: "Document-Driven Development"
      description: "Should mention DDD"

    # === SECTION 4: Prompting Techniques ===

    - action: send_input
      value: "Section 4\n"
      description: "Jump to prompting section"

    - action: wait_for_output
      contains: "Prompting Techniques"
      timeout: 15s

    - action: verify_output
      matches: "anatomy|structure|effective|clear"
      description: "Should teach prompting strategies"

    - action: verify_output
      matches: "example|bad.*good|mistake"
      description: "Should show examples of good vs bad prompts"

    # Platform-specific prompting
    - action: verify_output
      matches: "Claude Code|Amplifier|Copilot|Codex|RustyClawd"
      description: "Should cover platform-specific patterns"

    # === SECTION 5: Continuous Work ===

    - action: send_input
      value: "Section 5\n"
      description: "Jump to continuous work section"

    - action: wait_for_output
      contains: "Continuous Work"
      timeout: 15s

    # Auto mode coverage
    - action: verify_output
      contains: "--auto"
      description: "Should show auto mode flag"

    - action: verify_output
      contains: "--max-turns"
      description: "Should explain max turns parameter"

    - action: verify_output
      contains: "--append"
      description: "Should explain mid-session injection"

    # Lock mode coverage
    - action: verify_output
      contains: "lock_tool.py lock"
      description: "Should show lock command"

    - action: verify_output
      contains: "lock_tool.py unlock"
      description: "Should show unlock command"

    - action: verify_output
      contains: "--message"
      description: "Should explain custom lock messages"

    # === SECTION 6: Goal Agents ===

    - action: send_input
      value: "Section 6\n"
      description: "Jump to goal agents section"

    - action: wait_for_output
      contains: "Goal Agents"
      timeout: 15s

    - action: verify_output
      contains: "amplihack new --file"
      description: "Should show goal agent creation"

    - action: verify_output
      matches: "SMART|constraint|success criteria"
      description: "Should explain goal structure"

    - action: verify_output
      contains: "domain"
      description: "Should mention domain types"

    # === SECTION 7: Advanced Topics ===

    - action: send_input
      value: "Section 7\n"
      description: "Jump to advanced topics"

    - action: wait_for_output
      contains: "Advanced Topics"
      timeout: 15s

    - action: verify_output
      contains: "74"
      description: "Should mention 74+ skills"

    - action: verify_output
      contains: "hooks"
      description: "Should cover hooks system"

    - action: verify_output
      matches: "memory|Neo4j|5-type"
      description: "Should cover memory systems"

    # === PHASE 2: Verify Tutorial Quality ===

    # Test all platforms mentioned
    - action: send_input
      value: "Menu\n"
      description: "Return to menu"

    - action: wait_for_output
      contains: "Main Menu"
      timeout: 10s

    # Verify comprehensive coverage
    - action: verify_output
      contains: "Section 1"
    - action: verify_output
      contains: "Section 2"
    - action: verify_output
      contains: "Section 3"
    - action: verify_output
      contains: "Section 4"
    - action: verify_output
      contains: "Section 5"
    - action: verify_output
      contains: "Section 6"
    - action: verify_output
      contains: "Section 7"

    # === PHASE 3: Documentation Links ===

    - action: verify_output
      contains: "docs/tutorials/amplihack-tutorial.md"
      description: "Should link to complete tutorial docs"

    - action: verify_output
      contains: "docs/tutorials/README.md"
      description: "Should link to tutorial index"

    # === PHASE 4: Philosophy Compliance ===

    # Zero-BS check
    - action: verify_output
      contains: "TODO"
      expected: false
      description: "No TODOs (Zero-BS)"

    - action: verify_output
      contains: "Coming soon"
      expected: false
      description: "No placeholders"

    - action: verify_output
      contains: "TBD"
      expected: false
      description: "No stubs"

    # Verify exit
    - action: verify_exit_code
      expected: 0

  cleanup:
    - action: stop_application

# Complete User Journey (90 minutes simulated):
#
# 1. Beginner Assessment (2 min)
# 2. Section 1: Welcome & Setup (5 min)
# 3. Section 2: First Workflow (10 min)
# 4. Section 3: Workflows Deep Dive (15 min)
# 5. Section 4: Prompting Techniques (15 min)
# 6. Section 5: Continuous Work (15 min)
# 7. Section 6: Goal Agents with Workshop (20 min)
# 8. Section 7: Advanced Topics (15 min)
# 9. Navigation testing (5 min)

# Run Command:
# gadugi-agentic-test run .claude/tests/agentic/guide-agent-comprehensive-tutorial.yaml --verbose --save-evidence

# Success Criteria:
# ✅ All 7 sections accessible and complete
# ✅ Skill assessment adapts content
# ✅ Goal structuring workshop functional
# ✅ All 5 platforms documented
# ✅ All workflows covered
# ✅ Lock/unlock, auto mode explained
# ✅ Cross-references to docs present
# ✅ No TODOs or placeholders
# ✅ Progressive disclosure working
# ✅ Navigation commands functional

# Evidence Artifacts:
# - ./evidence/guide-agent-comprehensive-tutorial/
#   ├── execution.log (full conversation log)
#   ├── screenshots/ (screen captures at key points)
#   ├── output-captures/ (agent responses)
#   └── report.html (test results summary)
