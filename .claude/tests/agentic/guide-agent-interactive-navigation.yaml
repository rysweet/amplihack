# Level 2: Guide Agent - Interactive Navigation and Section Access
# Tests user navigation through sections, skill-level adaptation, and interactive features

scenario:
  name: "Guide Agent - Interactive Navigation Flow"
  description: |
    Simulates realistic user interaction with guide agent tutorial system.
    Tests section jumping, progressive disclosure, and skill-based content adaptation.
  type: cli
  level: 2

  tags: [guide-agent, tutorial, interactive, navigation, intermediate]

  prerequisites:
    - "amplihack installed"
    - "Guide agent v2.0.0 available"
    - "API access configured"

  environment:
    variables:
      ANTHROPIC_API_KEY: "${ANTHROPIC_API_KEY}"

  # Test data
  variables:
    beginner_skill: "A"
    intermediate_skill: "C"
    advanced_skill: "D"

  steps:
    # Scenario 1: Beginner User Path
    - action: launch
      target: "amplihack"
      args: ["claude", "--", "-p", "Task(subagent_type='guide', prompt='Start tutorial - I am a complete beginner')"]
      description: "Invoke guide as beginner user"
      timeout: 60s

    - action: wait_for_output
      contains: "Welcome aboard"
      timeout: 15s
      description: "Wait for guide agent response"

    - action: verify_output
      contains: "Skill Assessment"
      description: "Should show skill assessment"

    # Simulate beginner responding
    - action: send_input
      value: "I am a complete beginner\n"
      description: "User identifies as beginner"

    - action: wait_for_output
      contains: "Section 1"
      timeout: 10s
      description: "Should recommend starting point"

    # Test Section Navigation
    - action: send_input
      value: "Section 1\n"
      description: "User requests Section 1"

    - action: wait_for_output
      contains: "Welcome & Setup"
      timeout: 10s
      description: "Should show Section 1 content"

    - action: verify_output
      contains: "amplihack is"
      description: "Should explain what amplihack is"

    - action: verify_output
      contains: "philosophy"
      description: "Should cover core philosophy"

    # Scenario 2: Navigation Commands
    - action: send_input
      value: "Continue\n"
      description: "User requests next section"

    - action: wait_for_output
      contains: "Section 2"
      timeout: 10s
      description: "Should advance to Section 2"

    - action: verify_output
      contains: "First Workflow"
      description: "Should show Section 2 content"

    # Test Menu Command
    - action: send_input
      value: "Menu\n"
      description: "User requests main menu"

    - action: wait_for_output
      contains: "Main Menu"
      timeout: 10s
      description: "Should show navigation menu"

    - action: verify_output
      contains: "Section 3"
      description: "Menu should list all sections"

    - action: verify_output
      contains: "Section 7"
      description: "Menu should include advanced topics"

    # Scenario 3: Jump to Specific Section
    - action: send_input
      value: "Section 5\n"
      description: "User jumps to Continuous Work section"

    - action: wait_for_output
      contains: "Continuous Work"
      timeout: 10s
      description: "Should jump to Section 5"

    - action: verify_output
      contains: "Auto mode"
      description: "Should cover auto mode"

    - action: verify_output
      contains: "Lock mode"
      description: "Should cover lock mode"

    - action: verify_output
      matches: "python .+lock_tool\\.py"
      description: "Should show lock mode command"

    # Scenario 4: Cross-References
    - action: verify_output
      contains: "AUTO_MODE.md"
      description: "Should reference AUTO_MODE documentation"

    # Test Section 6 (Goal Agents)
    - action: send_input
      value: "Section 6\n"
      description: "Jump to Goal Agents section"

    - action: wait_for_output
      contains: "Goal Agents"
      timeout: 10s
      description: "Should show Section 6"

    - action: verify_output
      contains: "amplihack new"
      description: "Should show goal agent generation command"

    - action: verify_output
      contains: "GOAL_AGENT_GENERATOR"
      description: "Should reference goal agent guide"

    # Scenario 5: Help Command
    - action: send_input
      value: "Help\n"
      description: "User requests help"

    - action: wait_for_output
      contains: "assistance"
      timeout: 10s
      description: "Should provide help"

    - action: verify_output
      matches: "Section [1-7]|Menu|Continue"
      description: "Should show navigation options"

    # Verify completion
    - action: verify_exit_code
      expected: 0

  cleanup:
    - action: stop_application
      force: false

# User Journey Flow:
# 1. User identifies as beginner
# 2. Guide recommends Section 1
# 3. User navigates to Section 1 (Welcome)
# 4. User continues to Section 2 (First Workflow)
# 5. User requests Menu
# 6. User jumps to Section 5 (Continuous Work)
# 7. User jumps to Section 6 (Goal Agents)
# 8. User requests Help

# Run Command:
# gadugi-agentic-test run .claude/tests/agentic/guide-agent-interactive-navigation.yaml

# Success Criteria:
# ✅ Guide agent invokes successfully
# ✅ Skill assessment works
# ✅ All 7 sections accessible
# ✅ Navigation commands functional (Menu, Continue, Section N)
# ✅ Help command provides assistance
# ✅ Cross-references to docs present
# ✅ Platform-specific content shown
