# Debate Workflow Recipe
# Converted from amplihack's DEBATE_WORKFLOW.md (8 steps)
# Multi-agent structured debate for complex decisions

name: "debate-workflow"
description: "Multi-agent structured debate for complex decisions requiring diverse perspectives. Uses thesis/antithesis/synthesis pattern with 3-7 perspectives."
version: "1.0.0"
author: "amplihack team"
tags: ["debate", "decision", "multi-agent", "perspectives", "consensus"]

context:
  decision_topic: "{{user_decision}}"
  num_perspectives: 3  # 3, 5, or 7
  debate_rounds: 3     # 2-5
  convergence: "synthesis"  # 100%, 2/3, synthesis, evidence

recursion:
  max_depth: 3
  max_total_steps: 40

steps:
  - id: "step-1-frame"
    name: "Step 1: Frame the Decision"
    type: agent
    agent: "foundation:zen-architect"
    prompt: |
      STEP 1: FRAME THE DECISION

      Decision Topic: {{decision_topic}}

      Frame the decision clearly before debate begins.

      Tasks:
      1. Define the decision to be made
      2. Identify evaluation criteria
      3. List known constraints
      4. Define what "good decision" looks like
      5. Identify stakeholders affected

      Output:
      - Decision statement
      - Evaluation criteria (weighted)
      - Constraints and boundaries
      - Success metrics
    outputs:
      decision_frame: "{{result}}"

  - id: "step-2-perspectives"
    name: "Step 2: Initialize Perspectives"
    type: agent
    agent: "amplihack:multi-agent-debate"
    prompt: |
      STEP 2: INITIALIZE PERSPECTIVES

      Decision: {{steps.step-1-frame.decision_frame}}
      Number of perspectives: {{num_perspectives}}

      Standard perspectives to consider:

      SECURITY (security agent):
      - Focus: Vulnerabilities, attack vectors, data protection
      - Questions: "What could go wrong? How prevent breaches?"

      PERFORMANCE (optimizer agent):
      - Focus: Speed, scalability, resource efficiency
      - Questions: "Will this scale? What are bottlenecks?"

      SIMPLICITY (cleanup + reviewer agents):
      - Focus: Minimal complexity, ruthless simplification
      - Questions: "Is this simplest? Can we remove abstractions?"

      MAINTAINABILITY (reviewer + architect agents):
      - Focus: Long-term evolution, technical debt
      - Questions: "Can future devs understand? How hard to change?"

      USER EXPERIENCE (api-designer agent):
      - Focus: API design, usability, developer experience
      - Questions: "Is this intuitive? How will users interact?"

      Select {{num_perspectives}} most relevant perspectives for this decision.
    outputs:
      perspectives: "{{result}}"

  - id: "step-3-positions"
    name: "Step 3: Initial Positions"
    type: agent
    agent: "amplihack:multi-agent-debate"
    prompt: |
      STEP 3: INITIAL POSITIONS

      Decision: {{steps.step-1-frame.decision_frame}}
      Perspectives: {{steps.step-2-perspectives.perspectives}}

      Each perspective provides independent analysis:

      For each perspective:
      1. State position on the decision
      2. Provide evidence supporting position
      3. Identify risks from their viewpoint
      4. Propose approach they favor
      5. List concerns about other approaches

      CRITICAL: Arguments must be evidence-based, not opinion-based.
    outputs:
      initial_positions: "{{result}}"

  - id: "step-4-challenge"
    name: "Step 4: Challenge and Respond"
    type: agent
    agent: "amplihack:multi-agent-debate"
    prompt: |
      STEP 4: CHALLENGE AND RESPOND

      Positions: {{steps.step-3-positions.initial_positions}}
      Rounds: {{debate_rounds}}

      Execute debate rounds:

      For each round:
      1. Each perspective challenges others' positions
      2. Identify weaknesses in other arguments
      3. Present counter-evidence
      4. Respond to challenges against own position
      5. Refine position based on valid challenges

      Track:
      - Points of genuine disagreement
      - Areas where positions evolved
      - Strongest arguments from each side
    outputs:
      debate_results: "{{result}}"

  - id: "step-5-common-ground"
    name: "Step 5: Common Ground Synthesis"
    type: agent
    agent: "amplihack:insight-synthesizer"
    prompt: |
      STEP 5: COMMON GROUND SYNTHESIS

      Debate Results: {{steps.step-4-challenge.debate_results}}

      Identify areas of agreement:

      1. Points all perspectives agree on
      2. Non-negotiable requirements (security, performance, etc.)
      3. Trade-offs everyone acknowledges
      4. Approaches that satisfy multiple perspectives
      5. Remaining genuine disagreements

      Output synthesis of common ground and remaining disputes.
    outputs:
      common_ground: "{{result}}"

  - id: "step-6-facilitator"
    name: "Step 6: Facilitator Synthesis"
    type: agent
    agent: "foundation:zen-architect"
    prompt: |
      STEP 6: FACILITATOR SYNTHESIS

      Decision Frame: {{steps.step-1-frame.decision_frame}}
      Common Ground: {{steps.step-5-common-ground.common_ground}}
      Debate Results: {{steps.step-4-challenge.debate_results}}
      Convergence Criteria: {{convergence}}

      As neutral facilitator, synthesize the debate:

      Based on convergence criteria ({{convergence}}):
      - 100%: Identify unanimous agreement
      - 2/3: Determine majority position
      - synthesis: Create best hybrid approach
      - evidence: Follow strongest arguments

      Output:
      - Recommended decision
      - Rationale for recommendation
      - How each perspective is addressed
      - Trade-offs accepted
      - Dissenting views and why overruled
    outputs:
      synthesis: "{{result}}"

  - id: "step-7-document"
    name: "Step 7: Decision Documentation"
    type: agent
    agent: "amplihack:documentation-writer"
    prompt: |
      STEP 7: DECISION DOCUMENTATION

      Synthesis: {{steps.step-6-facilitator.synthesis}}
      Decision Frame: {{steps.step-1-frame.decision_frame}}

      Document the decision for future reference:

      Include:
      1. Decision made
      2. Full rationale
      3. Perspectives considered
      4. Arguments for and against
      5. Trade-offs accepted
      6. Dissenting views (preserve minority opinions)
      7. Conditions that might change this decision
      8. Implementation recommendations

      This becomes an ADR (Architecture Decision Record).
    outputs:
      decision_document: "{{result}}"

  - id: "step-8-implementation"
    name: "Step 8: Implementation Planning"
    type: agent
    agent: "foundation:modular-builder"
    prompt: |
      STEP 8: IMPLEMENTATION PLANNING

      Decision: {{steps.step-7-document.decision_document}}

      Create implementation plan based on the decision:

      1. Break decision into actionable tasks
      2. Identify dependencies
      3. Estimate effort
      4. Assign to appropriate workflow (DEFAULT_WORKFLOW)
      5. Define checkpoints to verify decision working

      Output ready-to-execute implementation plan.
    outputs:
      implementation_plan: "{{result}}"
