# Q&A Workflow - Minimal overhead for simple questions
# Fastest workflow: classify → answer → escalation check

name: "qa-workflow"
description: "Minimal 3-step workflow for simple questions and informational requests"
version: "1.0.0"
tags: ["qa", "quick", "minimal"]

context:
  question: ""           # Required: The user's question
  context: ""            # Optional: Additional context

steps:
  # Step 1: Quick classification - is this truly Q&A?
  - id: "classify"
    agent: "foundation:explorer"
    prompt: |
      Classify this request quickly:

      Question: {{question}}
      Context: {{context}}

      Determine if this is TRUE Q&A (answer in one response, no code changes, no exploration needed).

      Return JSON only:
      {
        "is_qa": true/false,
        "reason": "brief reason",
        "escalate_to": null | "investigation" | "default"
      }

      Escalate to "investigation" if: needs code exploration, tracing, or deep analysis
      Escalate to "default" if: needs implementation, file changes, or creation
    output: "classification"
    parse_json: true
    timeout: 60

  # Step 2: Provide response (runs regardless - either answer or escalation notice)
  - id: "respond"
    agent: "foundation:zen-architect"
    mode: "ANALYZE"
    prompt: |
      Classification: {{classification}}
      Question: {{question}}
      Context: {{context}}

      If classification.is_qa is true:
        - Answer directly and concisely
        - Include code examples only if helpful
        - Keep response appropriately sized

      If classification.is_qa is false:
        - Briefly acknowledge the question
        - Explain why it needs a different workflow
        - State which workflow is recommended

      Provide your response as the answer.
    output: "response"
    timeout: 120

  # Step 3: Final escalation check - structured output
  - id: "finalize"
    agent: "foundation:explorer"
    prompt: |
      Original question: {{question}}
      Classification: {{classification}}
      Response given: {{response}}

      Produce final structured output as JSON only:
      {
        "answer": "the response text (copy from response above)",
        "escalation_needed": true/false,
        "escalation_target": null | "investigation" | "default"
      }

      Rules:
      - escalation_needed = true if classification showed this isn't Q&A
      - escalation_target = classification.escalate_to value
      - answer = the response provided above
    output: "result"
    parse_json: true
    timeout: 60

# Usage:
#   amplifier recipes execute qa-workflow.yaml \
#     --context '{"question": "What is the default timeout?", "context": "Looking at config options"}'
#
# Output structure:
#   result.answer - The response to the question
#   result.escalation_needed - Whether a different workflow is needed
#   result.escalation_target - "investigation" | "default" | null
