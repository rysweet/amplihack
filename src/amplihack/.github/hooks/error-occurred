#!/usr/bin/env bash
# GitHub Copilot compatible error-occurred hook
# Wrapper that calls Python implementation

set -e

# Get the root directory of the repository
REPO_ROOT="$(git rev-parse --show-toplevel 2>/dev/null)" || {
    echo "Error: Not in a git repository" >&2
    exit 1
}

# Call Python implementation (if it exists, otherwise just log)
if [[ -f "${REPO_ROOT}/.claude/tools/amplihack/hooks/error_occurred.py" ]]; then
    python3 "${REPO_ROOT}/.claude/tools/amplihack/hooks/error_occurred.py" "$@"
else
    # Fallback: just log the error
    INPUT=$(cat)
    ERROR_MSG=$(echo "$INPUT" | jq -r '.error.message' 2>/dev/null || echo "unknown")
    echo "$(date): ERROR - $ERROR_MSG" >> "${REPO_ROOT}/.claude/runtime/logs/errors.log"
fi
