<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Agentic coding framework that uses specialized AI agents to accelerate software development"><meta name=author content="amplihack contributors"><link href=https://rysweet.github.io/amplihack/claude/context/DISCOVERIES/ rel=canonical><link href=../../../remote-sessions/TUTORIAL/ rel=prev><link href=../../../SECURITY_RECOMMENDATIONS/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Discoveries - amplihack</title><link rel=stylesheet href=../../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../css/timeago.css><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#discoveriesmd class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=amplihack class="md-header__button md-logo" aria-label=amplihack data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> amplihack </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Discoveries </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/rysweet/amplihack title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> rysweet/amplihack </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../PREREQUISITES/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../PHILOSOPHY/ class=md-tabs__link> Core Concepts </a> </li> <li class=md-tabs__item> <a href=../../workflow/DEFAULT_WORKFLOW/ class=md-tabs__link> Workflows </a> </li> <li class=md-tabs__item> <a href=../../agents/ class=md-tabs__link> Agents </a> </li> <li class=md-tabs__item> <a href=../../../commands/COMMAND_SELECTION_GUIDE/ class=md-tabs__link> Commands </a> </li> <li class=md-tabs__item> <a href=../../skills/README.md class=md-tabs__link> Skills </a> </li> <li class=md-tabs__item> <a href=../../scenarios/ class=md-tabs__link> Tools </a> </li> <li class=md-tabs__item> <a href=../../../DEVELOPING_AMPLIHACK/ class=md-tabs__link> Advanced Topics </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Reference </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=amplihack class="md-nav__button md-logo" aria-label=amplihack data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> amplihack </label> <div class=md-nav__source> <a href=https://github.com/rysweet/amplihack title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> rysweet/amplihack </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../PREREQUISITES/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../../INTERACTIVE_INSTALLATION/ class=md-nav__link> <span class=md-ellipsis> Interactive Setup </span> </a> </li> <li class=md-nav__item> <a href=../../../README.md class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Core Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Core Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../PHILOSOPHY/ class=md-nav__link> <span class=md-ellipsis> Philosophy </span> </a> </li> <li class=md-nav__item> <a href=../PROJECT/ class=md-nav__link> <span class=md-ellipsis> Project Overview </span> </a> </li> <li class=md-nav__item> <a href=../PATTERNS/ class=md-nav__link> <span class=md-ellipsis> Patterns </span> </a> </li> <li class=md-nav__item> <a href=../TRUST/ class=md-nav__link> <span class=md-ellipsis> Trust & Anti-Sycophancy </span> </a> </li> <li class=md-nav__item> <a href=../USER_PREFERENCES/ class=md-nav__link> <span class=md-ellipsis> User Preferences </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Workflows </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Workflows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../workflow/DEFAULT_WORKFLOW/ class=md-nav__link> <span class=md-ellipsis> Default Workflow </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Document-Driven Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Document-Driven Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../document_driven_development/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/overview/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_2_3> <label class=md-nav__link for=__nav_4_2_3 id=__nav_4_2_3_label tabindex=0> <span class=md-ellipsis> Core Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_3> <span class="md-nav__icon md-icon"></span> Core Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../document_driven_development/core_concepts/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/core_concepts/context_poisoning/ class=md-nav__link> <span class=md-ellipsis> Context Poisoning </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/core_concepts/file_crawling/ class=md-nav__link> <span class=md-ellipsis> File Crawling </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/core_concepts/retcon_writing/ class=md-nav__link> <span class=md-ellipsis> Retcon Writing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_2_4> <label class=md-nav__link for=__nav_4_2_4 id=__nav_4_2_4_label tabindex=0> <span class=md-ellipsis> Phase Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_4> <span class="md-nav__icon md-icon"></span> Phase Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../document_driven_development/phases/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/phases/00_planning_and_alignment/ class=md-nav__link> <span class=md-ellipsis> Phase 0 - Planning </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/phases/01_documentation_retcon/ class=md-nav__link> <span class=md-ellipsis> Phase 1 - Documentation </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/phases/02_approval_gate/ class=md-nav__link> <span class=md-ellipsis> Phase 2 - Approval </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/phases/03_implementation_planning/ class=md-nav__link> <span class=md-ellipsis> Phase 3 - Planning </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/phases/04_code_implementation/ class=md-nav__link> <span class=md-ellipsis> Phase 4 - Implementation </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/phases/05_testing_and_verification/ class=md-nav__link> <span class=md-ellipsis> Phase 5 - Testing </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/phases/06_cleanup_and_push/ class=md-nav__link> <span class=md-ellipsis> Phase 6 - Cleanup </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_2_5> <label class=md-nav__link for=__nav_4_2_5 id=__nav_4_2_5_label tabindex=0> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2_5> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../document_driven_development/reference/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/reference/checklists/ class=md-nav__link> <span class=md-ellipsis> Checklists </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/reference/common_pitfalls/ class=md-nav__link> <span class=md-ellipsis> Common Pitfalls </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/reference/faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../../../document_driven_development/reference/tips_for_success/ class=md-nav__link> <span class=md-ellipsis> Tips for Success </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../workflow/N_VERSION_WORKFLOW/ class=md-nav__link> <span class=md-ellipsis> N-Version Programming </span> </a> </li> <li class=md-nav__item> <a href=../../workflow/DEBATE_WORKFLOW/ class=md-nav__link> <span class=md-ellipsis> Multi-Agent Debate </span> </a> </li> <li class=md-nav__item> <a href=../../workflow/CASCADE_WORKFLOW/ class=md-nav__link> <span class=md-ellipsis> Fallback Cascade </span> </a> </li> <li class=md-nav__item> <a href=../../workflow/INVESTIGATION_WORKFLOW/ class=md-nav__link> <span class=md-ellipsis> Investigation Workflow </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/specialized/pre-commit-diagnostic/ class=md-nav__link> <span class=md-ellipsis> Pre-Commit Diagnostic </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/specialized/ci-diagnostic-workflow/ class=md-nav__link> <span class=md-ellipsis> CI Diagnostic </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/specialized/fix-agent/ class=md-nav__link> <span class=md-ellipsis> Fix Workflow </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Agents </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Agents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../agents/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> Core Agents </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Core Agents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../agents/amplihack/core/architect/ class=md-nav__link> <span class=md-ellipsis> Architect </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/core/builder/ class=md-nav__link> <span class=md-ellipsis> Builder </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/core/reviewer/ class=md-nav__link> <span class=md-ellipsis> Reviewer </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/core/tester/ class=md-nav__link> <span class=md-ellipsis> Tester </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> Specialized Agents </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> Specialized Agents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../agents/amplihack/core/api-designer/ class=md-nav__link> <span class=md-ellipsis> API Designer </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/specialized/security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/specialized/database/ class=md-nav__link> <span class=md-ellipsis> Database </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/specialized/integration/ class=md-nav__link> <span class=md-ellipsis> Integration </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/specialized/knowledge-archaeologist/ class=md-nav__link> <span class=md-ellipsis> Knowledge Archaeologist </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> Workflow Agents </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> Workflow Agents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../agents/amplihack/specialized/ambiguity/ class=md-nav__link> <span class=md-ellipsis> Ambiguity Handler </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/specialized/cleanup/ class=md-nav__link> <span class=md-ellipsis> Cleanup </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/core/optimizer/ class=md-nav__link> <span class=md-ellipsis> Optimizer </span> </a> </li> <li class=md-nav__item> <a href=../../agents/amplihack/specialized/patterns/ class=md-nav__link> <span class=md-ellipsis> Pattern Recognition </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Commands </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Commands </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../commands/COMMAND_SELECTION_GUIDE/ class=md-nav__link> <span class=md-ellipsis> Command Guide </span> </a> </li> <li class=md-nav__item> <a href=../../commands/amplihack/ultrathink/ class=md-nav__link> <span class=md-ellipsis> /ultrathink </span> </a> </li> <li class=md-nav__item> <a href=../../commands/amplihack/analyze/ class=md-nav__link> <span class=md-ellipsis> /analyze </span> </a> </li> <li class=md-nav__item> <a href=../../commands/amplihack/improve/ class=md-nav__link> <span class=md-ellipsis> /improve </span> </a> </li> <li class=md-nav__item> <a href=../../commands/amplihack/fix/ class=md-nav__link> <span class=md-ellipsis> /fix </span> </a> </li> <li class=md-nav__item> <a href=../../commands/amplihack/n-version/ class=md-nav__link> <span class=md-ellipsis> /n-version </span> </a> </li> <li class=md-nav__item> <a href=../../commands/amplihack/debate/ class=md-nav__link> <span class=md-ellipsis> /debate </span> </a> </li> <li class=md-nav__item> <a href=../../commands/amplihack/cascade/ class=md-nav__link> <span class=md-ellipsis> /cascade </span> </a> </li> <li class=md-nav__item> <a href=../../commands/amplihack/customize/ class=md-nav__link> <span class=md-ellipsis> /customize </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6_10> <label class=md-nav__link for=__nav_6_10 id=__nav_6_10_label tabindex=0> <span class=md-ellipsis> DDD Commands </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_10_label aria-expanded=false> <label class=md-nav__title for=__nav_6_10> <span class="md-nav__icon md-icon"></span> DDD Commands </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../commands/ddd/0-help/ class=md-nav__link> <span class=md-ellipsis> /ddd:0-help </span> </a> </li> <li class=md-nav__item> <a href=../../commands/ddd/prime/ class=md-nav__link> <span class=md-ellipsis> /ddd:prime </span> </a> </li> <li class=md-nav__item> <a href=../../commands/ddd/1-plan/ class=md-nav__link> <span class=md-ellipsis> /ddd:1-plan </span> </a> </li> <li class=md-nav__item> <a href=../../commands/ddd/2-docs/ class=md-nav__link> <span class=md-ellipsis> /ddd:2-docs </span> </a> </li> <li class=md-nav__item> <a href=../../commands/ddd/3-code-plan/ class=md-nav__link> <span class=md-ellipsis> /ddd:3-code-plan </span> </a> </li> <li class=md-nav__item> <a href=../../commands/ddd/4-code/ class=md-nav__link> <span class=md-ellipsis> /ddd:4-code </span> </a> </li> <li class=md-nav__item> <a href=../../commands/ddd/5-finish/ class=md-nav__link> <span class=md-ellipsis> /ddd:5-finish </span> </a> </li> <li class=md-nav__item> <a href=../../commands/ddd/status/ class=md-nav__link> <span class=md-ellipsis> /ddd:status </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Skills </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Skills </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../skills/README.md class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> Available Skills </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> Available Skills </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../skills/agent-sdk/SKILL/ class=md-nav__link> <span class=md-ellipsis> Agent SDK </span> </a> </li> <li class=md-nav__item> <a href=../../skills/docx/SKILL/ class=md-nav__link> <span class=md-ellipsis> DOCX </span> </a> </li> <li class=md-nav__item> <a href=../../skills/pptx/SKILL/ class=md-nav__link> <span class=md-ellipsis> PPTX </span> </a> </li> <li class=md-nav__item> <a href=../../skills/xlsx/SKILL/ class=md-nav__link> <span class=md-ellipsis> XLSX </span> </a> </li> <li class=md-nav__item> <a href=../../skills/pdf/SKILL/ class=md-nav__link> <span class=md-ellipsis> PDF </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../scenarios/ class=md-nav__link> <span class=md-ellipsis> Scenarios Overview </span> </a> </li> <li class=md-nav__item> <a href=../../scenarios/analyze-codebase/ class=md-nav__link> <span class=md-ellipsis> Analyze Codebase </span> </a> </li> <li class=md-nav__item> <a href=../../../CREATE_YOUR_OWN_TOOLS/ class=md-nav__link> <span class=md-ellipsis> Creating Tools </span> </a> </li> <li class=md-nav__item> <a href=../../../HOOK_CONFIGURATION_GUIDE/ class=md-nav__link> <span class=md-ellipsis> Hooks Configuration </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Advanced Topics </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Advanced Topics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../DEVELOPING_AMPLIHACK/ class=md-nav__link> <span class=md-ellipsis> Development Guide </span> </a> </li> <li class=md-nav__item> <a href=../../../AGENT_MEMORY_INTEGRATION/ class=md-nav__link> <span class=md-ellipsis> Agent Memory Integration </span> </a> </li> <li class=md-nav__item> <a href=../../../AGENT_MEMORY_QUICKSTART/ class=md-nav__link> <span class=md-ellipsis> Memory Quickstart </span> </a> </li> <li class=md-nav__item> <a href=../../../external_knowledge_integration/ class=md-nav__link> <span class=md-ellipsis> External Knowledge </span> </a> </li> <li class=md-nav__item> <a href=../../../documentation_knowledge_graph/ class=md-nav__link> <span class=md-ellipsis> Documentation Graph </span> </a> </li> <li class=md-nav__item> <a href=../../../blarify_integration/ class=md-nav__link> <span class=md-ellipsis> Blarify Integration </span> </a> </li> <li class=md-nav__item> <a href=../../../AZURE_INTEGRATION/ class=md-nav__link> <span class=md-ellipsis> Azure Integration </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_9_8> <label class=md-nav__link for=__nav_9_8 id=__nav_9_8_label tabindex=0> <span class=md-ellipsis> Remote Sessions </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_8_label aria-expanded=false> <label class=md-nav__title for=__nav_9_8> <span class="md-nav__icon md-icon"></span> Remote Sessions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../remote-sessions/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../remote-sessions/README.md class=md-nav__link> <span class=md-ellipsis> User Guide </span> </a> </li> <li class=md-nav__item> <a href=../../../remote-sessions/CLI_REFERENCE/ class=md-nav__link> <span class=md-ellipsis> CLI Reference </span> </a> </li> <li class=md-nav__item> <a href=../../../remote-sessions/TUTORIAL/ class=md-nav__link> <span class=md-ellipsis> Tutorial </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10 checked> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=true> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Discoveries </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Discoveries </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> <nav class=md-nav aria-label="Table of Contents"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#recent-december-2025 class=md-nav__link> <span class=md-ellipsis> Recent (December 2025) </span> </a> </li> <li class=md-nav__item> <a href=#november-2025 class=md-nav__link> <span class=md-ellipsis> November 2025 </span> </a> </li> <li class=md-nav__item> <a href=#october-2025 class=md-nav__link> <span class=md-ellipsis> October 2025 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#entry-format-template class=md-nav__link> <span class=md-ellipsis> Entry Format Template </span> </a> </li> <li class=md-nav__item> <a href=#system-metadata-vs-user-content-in-git-conflict-detection-2025-12-01 class=md-nav__link> <span class=md-ellipsis> System Metadata vs User Content in Git Conflict Detection (2025-12-01) </span> </a> <nav class=md-nav aria-label="System Metadata vs User Content in Git Conflict Detection (2025-12-01)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#problem class=md-nav__link> <span class=md-ellipsis> Problem </span> </a> </li> <li class=md-nav__item> <a href=#root-cause class=md-nav__link> <span class=md-ellipsis> Root Cause </span> </a> </li> <li class=md-nav__item> <a href=#solution class=md-nav__link> <span class=md-ellipsis> Solution </span> </a> </li> <li class=md-nav__item> <a href=#key-learnings class=md-nav__link> <span class=md-ellipsis> Key Learnings </span> </a> </li> <li class=md-nav__item> <a href=#related-patterns class=md-nav__link> <span class=md-ellipsis> Related Patterns </span> </a> </li> <li class=md-nav__item> <a href=#impact class=md-nav__link> <span class=md-ellipsis> Impact </span> </a> </li> <li class=md-nav__item> <a href=#verification class=md-nav__link> <span class=md-ellipsis> Verification </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#auto-mode-timeout-causing-opus-model-workflow-failures-2025-11-26 class=md-nav__link> <span class=md-ellipsis> Auto Mode Timeout Causing Opus Model Workflow Failures (2025-11-26) </span> </a> <nav class=md-nav aria-label="Auto Mode Timeout Causing Opus Model Workflow Failures (2025-11-26)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#problem_1 class=md-nav__link> <span class=md-ellipsis> Problem </span> </a> </li> <li class=md-nav__item> <a href=#root-cause_1 class=md-nav__link> <span class=md-ellipsis> Root Cause </span> </a> </li> <li class=md-nav__item> <a href=#solution-pr-1676 class=md-nav__link> <span class=md-ellipsis> Solution (PR #1676) </span> </a> </li> <li class=md-nav__item> <a href=#key-insight class=md-nav__link> <span class=md-ellipsis> Key Insight </span> </a> </li> <li class=md-nav__item> <a href=#files-changed class=md-nav__link> <span class=md-ellipsis> Files Changed </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#power-steering-session-type-detection-fix-2025-11-25 class=md-nav__link> <span class=md-ellipsis> Power-Steering Session Type Detection Fix (2025-11-25) </span> </a> <nav class=md-nav aria-label="Power-Steering Session Type Detection Fix (2025-11-25)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#problem_2 class=md-nav__link> <span class=md-ellipsis> Problem </span> </a> </li> <li class=md-nav__item> <a href=#root-cause_2 class=md-nav__link> <span class=md-ellipsis> Root Cause </span> </a> </li> <li class=md-nav__item> <a href=#solution_1 class=md-nav__link> <span class=md-ellipsis> Solution </span> </a> </li> <li class=md-nav__item> <a href=#key-learnings_1 class=md-nav__link> <span class=md-ellipsis> Key Learnings </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#transcripts-system-investigation-2025-11-22 class=md-nav__link> <span class=md-ellipsis> Transcripts System Investigation (2025-11-22) </span> </a> <nav class=md-nav aria-label="Transcripts System Investigation (2025-11-22)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#problem_3 class=md-nav__link> <span class=md-ellipsis> Problem </span> </a> </li> <li class=md-nav__item> <a href=#key-findings class=md-nav__link> <span class=md-ellipsis> Key Findings </span> </a> </li> <li class=md-nav__item> <a href=#key-learnings_2 class=md-nav__link> <span class=md-ellipsis> Key Learnings </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#hook-double-execution-claude-code-bug-2025-11-21 class=md-nav__link> <span class=md-ellipsis> Hook Double Execution - Claude Code Bug (2025-11-21) </span> </a> <nav class=md-nav aria-label="Hook Double Execution - Claude Code Bug (2025-11-21)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#problem_4 class=md-nav__link> <span class=md-ellipsis> Problem </span> </a> </li> <li class=md-nav__item> <a href=#root-cause_3 class=md-nav__link> <span class=md-ellipsis> Root Cause </span> </a> </li> <li class=md-nav__item> <a href=#solution_2 class=md-nav__link> <span class=md-ellipsis> Solution </span> </a> </li> <li class=md-nav__item> <a href=#key-learnings_3 class=md-nav__link> <span class=md-ellipsis> Key Learnings </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#statusline-configuration-missing-2025-11-18 class=md-nav__link> <span class=md-ellipsis> StatusLine Configuration Missing (2025-11-18) </span> </a> <nav class=md-nav aria-label="StatusLine Configuration Missing (2025-11-18)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#problem_5 class=md-nav__link> <span class=md-ellipsis> Problem </span> </a> </li> <li class=md-nav__item> <a href=#root-cause_4 class=md-nav__link> <span class=md-ellipsis> Root Cause </span> </a> </li> <li class=md-nav__item> <a href=#solution-issue-1433 class=md-nav__link> <span class=md-ellipsis> Solution (Issue #1433) </span> </a> </li> <li class=md-nav__item> <a href=#key-learnings_4 class=md-nav__link> <span class=md-ellipsis> Key Learnings </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#power-steering-path-validation-bug-2025-11-17 class=md-nav__link> <span class=md-ellipsis> Power-Steering Path Validation Bug (2025-11-17) </span> </a> <nav class=md-nav aria-label="Power-Steering Path Validation Bug (2025-11-17)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#problem_6 class=md-nav__link> <span class=md-ellipsis> Problem </span> </a> </li> <li class=md-nav__item> <a href=#root-cause_5 class=md-nav__link> <span class=md-ellipsis> Root Cause </span> </a> </li> <li class=md-nav__item> <a href=#solution_3 class=md-nav__link> <span class=md-ellipsis> Solution </span> </a> </li> <li class=md-nav__item> <a href=#key-learnings_5 class=md-nav__link> <span class=md-ellipsis> Key Learnings </span> </a> </li> <li class=md-nav__item> <a href=#prevention class=md-nav__link> <span class=md-ellipsis> Prevention </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#claude-trace-uvx-argument-passthrough-issue-2025-09-26 class=md-nav__link> <span class=md-ellipsis> Claude-Trace UVX Argument Passthrough Issue (2025-09-26) </span> </a> <nav class=md-nav aria-label="Claude-Trace UVX Argument Passthrough Issue (2025-09-26)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue class=md-nav__link> <span class=md-ellipsis> Issue </span> </a> </li> <li class=md-nav__item> <a href=#root-cause_6 class=md-nav__link> <span class=md-ellipsis> Root Cause </span> </a> </li> <li class=md-nav__item> <a href=#solution_4 class=md-nav__link> <span class=md-ellipsis> Solution </span> </a> </li> <li class=md-nav__item> <a href=#key-learnings_6 class=md-nav__link> <span class=md-ellipsis> Key Learnings </span> </a> </li> <li class=md-nav__item> <a href=#prevention_1 class=md-nav__link> <span class=md-ellipsis> Prevention </span> </a> </li> <li class=md-nav__item> <a href=#pattern-recognition class=md-nav__link> <span class=md-ellipsis> Pattern Recognition </span> </a> </li> <li class=md-nav__item> <a href=#testing-validation class=md-nav__link> <span class=md-ellipsis> Testing Validation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#socratic-questioning-pattern-for-knowledge-exploration-2025-10-18 class=md-nav__link> <span class=md-ellipsis> Socratic Questioning Pattern for Knowledge Exploration (2025-10-18) </span> </a> <nav class=md-nav aria-label="Socratic Questioning Pattern for Knowledge Exploration (2025-10-18)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#issue_1 class=md-nav__link> <span class=md-ellipsis> Issue </span> </a> </li> <li class=md-nav__item> <a href=#root-cause_7 class=md-nav__link> <span class=md-ellipsis> Root Cause </span> </a> </li> <li class=md-nav__item> <a href=#solution_5 class=md-nav__link> <span class=md-ellipsis> Solution </span> </a> </li> <li class=md-nav__item> <a href=#key-learnings_7 class=md-nav__link> <span class=md-ellipsis> Key Learnings </span> </a> </li> <li class=md-nav__item> <a href=#usage-context class=md-nav__link> <span class=md-ellipsis> Usage Context </span> </a> </li> <li class=md-nav__item> <a href=#evidence-status class=md-nav__link> <span class=md-ellipsis> Evidence Status </span> </a> </li> <li class=md-nav__item> <a href=#prevention_2 class=md-nav__link> <span class=md-ellipsis> Prevention </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pattern-applicability-analysis-framework-2025-10-20 class=md-nav__link> <span class=md-ellipsis> Pattern Applicability Analysis Framework (2025-10-20) </span> </a> <nav class=md-nav aria-label="Pattern Applicability Analysis Framework (2025-10-20)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#discovery class=md-nav__link> <span class=md-ellipsis> Discovery </span> </a> </li> <li class=md-nav__item> <a href=#context class=md-nav__link> <span class=md-ellipsis> Context </span> </a> </li> <li class=md-nav__item> <a href=#pattern-1-threat-model-precision-principle class=md-nav__link> <span class=md-ellipsis> Pattern 1: Threat Model Precision Principle </span> </a> </li> <li class=md-nav__item> <a href=#pattern-2-voting-vs-expert-judgment-selection-criteria class=md-nav__link> <span class=md-ellipsis> Pattern 2: Voting vs Expert Judgment Selection Criteria </span> </a> </li> <li class=md-nav__item> <a href=#pattern-3-distributed-systems-pattern-applicability-test class=md-nav__link> <span class=md-ellipsis> Pattern 3: Distributed Systems Pattern Applicability Test </span> </a> </li> <li class=md-nav__item> <a href=#pattern-4-complexity-benefit-trade-off-quantification class=md-nav__link> <span class=md-ellipsis> Pattern 4: Complexity-Benefit Trade-off Quantification </span> </a> </li> <li class=md-nav__item> <a href=#pattern-5-domain-appropriateness-check-for-best-practices class=md-nav__link> <span class=md-ellipsis> Pattern 5: Domain Appropriateness Check for "Best Practices" </span> </a> </li> <li class=md-nav__item> <a href=#pattern-6-diversity-as-error-reduction-mechanism class=md-nav__link> <span class=md-ellipsis> Pattern 6: Diversity as Error Reduction Mechanism </span> </a> </li> <li class=md-nav__item> <a href=#meta-pattern-systematic-pattern-applicability-analysis class=md-nav__link> <span class=md-ellipsis> Meta-Pattern: Systematic Pattern Applicability Analysis </span> </a> </li> <li class=md-nav__item> <a href=#key-learnings_8 class=md-nav__link> <span class=md-ellipsis> Key Learnings </span> </a> </li> <li class=md-nav__item> <a href=#prevention_3 class=md-nav__link> <span class=md-ellipsis> Prevention </span> </a> </li> <li class=md-nav__item> <a href=#integration-with-existing-philosophy class=md-nav__link> <span class=md-ellipsis> Integration with Existing Philosophy </span> </a> </li> <li class=md-nav__item> <a href=#files-referenced class=md-nav__link> <span class=md-ellipsis> Files Referenced </span> </a> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> <span class=md-ellipsis> Next Steps </span> </a> </li> <li class=md-nav__item> <a href=#related-patterns_1 class=md-nav__link> <span class=md-ellipsis> Related Patterns </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#massive-parallel-reflection-workstream-execution-2025-11-05 class=md-nav__link> <span class=md-ellipsis> Massive Parallel Reflection Workstream Execution (2025-11-05) </span> </a> <nav class=md-nav aria-label="Massive Parallel Reflection Workstream Execution (2025-11-05)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#context_1 class=md-nav__link> <span class=md-ellipsis> Context </span> </a> </li> <li class=md-nav__item> <a href=#discovery_1 class=md-nav__link> <span class=md-ellipsis> Discovery </span> </a> </li> <li class=md-nav__item> <a href=#root-cause-analysis class=md-nav__link> <span class=md-ellipsis> Root Cause Analysis </span> </a> </li> <li class=md-nav__item> <a href=#solution-patterns-that-worked class=md-nav__link> <span class=md-ellipsis> Solution Patterns That Worked </span> </a> </li> <li class=md-nav__item> <a href=#key-learnings_9 class=md-nav__link> <span class=md-ellipsis> Key Learnings </span> </a> </li> <li class=md-nav__item> <a href=#impact_1 class=md-nav__link> <span class=md-ellipsis> Impact </span> </a> </li> <li class=md-nav__item> <a href=#prevention-patterns class=md-nav__link> <span class=md-ellipsis> Prevention Patterns </span> </a> </li> <li class=md-nav__item> <a href=#files-modifiedcreated class=md-nav__link> <span class=md-ellipsis> Files Modified/Created </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../SECURITY_RECOMMENDATIONS/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../../../testing/README.md class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class=md-nav__item> <a href=../../../troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../../../CODE_REVIEW/ class=md-nav__link> <span class=md-ellipsis> Code Review </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/rysweet/amplihack/edit/main/docs/claude/context/DISCOVERIES.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/rysweet/amplihack/raw/main/docs/claude/context/DISCOVERIES.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=discoveriesmd>DISCOVERIES.md<a class=headerlink href=#discoveriesmd title="Permanent link">&para;</a></h1> <p>This file documents non-obvious problems, solutions, and patterns discovered during development. It serves as a living knowledge base.</p> <p><strong>Archive</strong>: Entries older than 3 months are moved to <a href=../DISCOVERIES_ARCHIVE/ >DISCOVERIES_ARCHIVE.md</a>.</p> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2> <h3 id=recent-december-2025>Recent (December 2025)<a class=headerlink href=#recent-december-2025 title="Permanent link">&para;</a></h3> <ul> <li><a href=#mandatory-user-testing-validates-value-2025-12-02>Mandatory User Testing Validates Its Own Value</a></li> <li><a href=#system-metadata-vs-user-content-git-conflict-2025-12-01>System Metadata vs User Content in Git Conflict Detection</a></li> </ul> <h3 id=november-2025>November 2025<a class=headerlink href=#november-2025 title="Permanent link">&para;</a></h3> <ul> <li><a href=#power-steering-session-type-detection-fix-2025-11-25>Power-Steering Session Type Detection Fix</a></li> <li><a href=#transcripts-system-investigation-2025-11-22>Transcripts System Architecture Validation</a></li> <li><a href=#hook-double-execution-claude-code-bug-2025-11-21>Hook Double Execution - Claude Code Bug</a></li> <li><a href=#statusline-configuration-missing-2025-11-18>StatusLine Configuration Missing</a></li> <li><a href=#power-steering-path-validation-bug-2025-11-17>Power-Steering Path Validation Bug</a></li> <li><a href=#power-steering-mode-branch-divergence-2025-11-16>Power Steering Branch Divergence</a></li> <li><a href=#mandatory-end-to-end-testing-pattern-2025-11-10>Mandatory End-to-End Testing Pattern</a></li> <li><a href=#neo4j-container-port-mismatch-bug-2025-11-08>Neo4j Container Port Mismatch</a></li> <li><a href=#parallel-reflection-workstream-execution-2025-11-05>Parallel Reflection Workstream Success</a></li> </ul> <h3 id=october-2025>October 2025<a class=headerlink href=#october-2025 title="Permanent link">&para;</a></h3> <ul> <li><a href=#pattern-applicability-analysis-framework-2025-10-20>Pattern Applicability Framework</a></li> <li><a href=#socratic-questioning-pattern-2025-10-18>Socratic Questioning Pattern</a></li> <li><a href=#expert-agent-creation-pattern-2025-10-18>Expert Agent Creation Pattern</a></li> </ul> <hr> <h2 id=entry-format-template>Entry Format Template<a class=headerlink href=#entry-format-template title="Permanent link">&para;</a></h2> <div class="language-markdown highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gu>## [Brief Title] (YYYY-MM-DD)</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=gu>### Problem</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>What challenge was encountered?
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=gu>### Root Cause</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>Why did this happen?
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=gu>### Solution</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>How was it resolved? Include code if relevant.
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=gu>### Key Learnings</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>What insights should be remembered?
</span></code></pre></div> <hr> <h2 id=system-metadata-vs-user-content-in-git-conflict-detection-2025-12-01>System Metadata vs User Content in Git Conflict Detection (2025-12-01)<a class=headerlink href=#system-metadata-vs-user-content-in-git-conflict-detection-2025-12-01 title="Permanent link">&para;</a></h2> <h3 id=problem>Problem<a class=headerlink href=#problem title="Permanent link">&para;</a></h3> <p>User reported: "amplihack's copytree_manifest fails when .claude/ has uncommitted changes" specifically with <code>~/.amplihack/.claude/.version</code> file modified. Despite having a comprehensive safety system (GitConflictDetector + SafeCopyStrategy), deployment proceeded without warning and created a version mismatch state.</p> <h3 id=root-cause>Root Cause<a class=headerlink href=#root-cause title="Permanent link">&para;</a></h3> <p>The <code>.version</code> file is a <strong>system-generated tracking file</strong> that stores the git commit hash of the deployed amplihack package. The issue occurred due to a semantic classification gap:</p> <ol> <li> <p><strong>Git Status Detection</strong>: <code>GitConflictDetector._get_uncommitted_files()</code> correctly detects ALL uncommitted files including <code>.version</code> (status: M)</p> </li> <li> <p><strong>Filtering Logic Gap</strong>: <code>_filter_conflicts()</code> at lines 82-97 in <code>git_conflict_detector.py</code> only checks files against ESSENTIAL_DIRS patterns:</p> </li> </ol> <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>for</span> <span class=n>essential_dir</span> <span class=ow>in</span> <span class=n>essential_dirs</span><span class=p>:</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>    <span class=k>if</span> <span class=n>relative_path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>essential_dir</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span><span class=p>):</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>        <span class=n>conflicts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></code></pre></div> <ol> <li> <p><strong>ESSENTIAL_DIRS Are All Subdirectories</strong>: <code>["agents/amplihack", "commands/amplihack", "context/", ...]</code> - all contain "/"</p> </li> <li> <p><strong>Root-Level Files Filtered Out</strong>: <code>.version</code> at <code>~/.amplihack/.claude/.version</code> doesn't match any pattern  filtered OUT  <code>has_conflicts = False</code></p> </li> <li> <p><strong>No Warning Issued</strong>: SafeCopyStrategy sees no conflicts, proceeds to working directory without prompting user</p> </li> <li> <p><strong>Version Mismatch Created</strong>: copytree_manifest copies fresh directories but <strong>doesn't copy <code>.version</code></strong> (not in ESSENTIAL_FILES), leaving stale version marker with fresh code</p> </li> </ol> <h3 id=solution>Solution<a class=headerlink href=#solution title="Permanent link">&para;</a></h3> <p>Exclude system-generated metadata files from conflict detection by adding explicit categorization:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># In src/amplihack/safety/git_conflict_detector.py</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=n>SYSTEM_METADATA</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>    <span class=s2>&quot;.version&quot;</span><span class=p>,</span>        <span class=c1># Framework version tracking (auto-generated)</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>    <span class=s2>&quot;settings.json&quot;</span><span class=p>,</span>   <span class=c1># Runtime settings (auto-generated)</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=p>}</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=k>def</span><span class=w> </span><span class=nf>_filter_conflicts</span><span class=p>(</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>    <span class=bp>self</span><span class=p>,</span> <span class=n>uncommitted_files</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>essential_dirs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Filter uncommitted files for conflicts with essential_dirs.&quot;&quot;&quot;</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>    <span class=n>conflicts</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>    <span class=k>for</span> <span class=n>file_path</span> <span class=ow>in</span> <span class=n>uncommitted_files</span><span class=p>:</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>        <span class=k>if</span> <span class=n>file_path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;.claude/&quot;</span><span class=p>):</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>            <span class=n>relative_path</span> <span class=o>=</span> <span class=n>file_path</span><span class=p>[</span><span class=mi>8</span><span class=p>:]</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>            <span class=c1># Skip system-generated metadata - safe to overwrite</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>            <span class=k>if</span> <span class=n>relative_path</span> <span class=ow>in</span> <span class=n>SYSTEM_METADATA</span><span class=p>:</span>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>                <span class=k>continue</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>            <span class=c1># Existing filtering logic for essential directories</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>            <span class=k>for</span> <span class=n>essential_dir</span> <span class=ow>in</span> <span class=n>essential_dirs</span><span class=p>:</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>                <span class=k>if</span> <span class=p>(</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>                    <span class=n>relative_path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>essential_dir</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span><span class=p>)</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>                    <span class=ow>or</span> <span class=n>relative_path</span> <span class=o>==</span> <span class=n>essential_dir</span>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>                <span class=p>):</span>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>                    <span class=n>conflicts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>                    <span class=k>break</span>
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>    <span class=k>return</span> <span class=n>conflicts</span>
</span></code></pre></div> <p><strong>Rationale</strong>:</p> <ul> <li><strong>Semantic Classification</strong>: Filter by PURPOSE (system vs user), not just directory structure</li> <li><strong>Ruthlessly Simple</strong>: 3-line change, surgical fix</li> <li><strong>Philosophy-Aligned</strong>: Treats system files appropriately (not user content)</li> <li><strong>Zero-BS</strong>: Fixes exact issue without over-engineering</li> </ul> <h3 id=key-learnings>Key Learnings<a class=headerlink href=#key-learnings title="Permanent link">&para;</a></h3> <ol> <li> <p><strong>Root-Level Files Need Special Handling</strong>: Directory-based filtering (checking for "/") misses root-level files entirely. System metadata often lives at root.</p> </li> <li> <p><strong>Semantic &gt; Structural Classification</strong>: Git conflict detection should categorize by FILE PURPOSE (user-managed vs system-generated), not just location patterns.</p> </li> <li> <p><strong>Auto-Generated Files vs User Content</strong>: Framework metadata files like <code>.version</code>, <code>*.lock</code>, <code>.state</code> should never trigger conflict warnings - they're infrastructure, not content.</p> </li> <li> <p><strong>ESSENTIAL_DIRS Pattern Limitation</strong>: Works great for subdirectories (<code>context/</code>, <code>tools/</code>), but silently excludes root-level files. Need explicit system file list.</p> </li> <li> <p><strong>False Negatives Are Worse Than False Positives</strong>: Safety system failing to warn about user content is bad, but warning about system files breaks user trust and workflow.</p> </li> <li> <p><strong>Version Files Are Special</strong>: Any framework with version tracking faces this - <code>.version</code>, <code>.state</code>, <code>.lock</code> files should be treated as disposable metadata, not user content to protect.</p> </li> </ol> <h3 id=related-patterns>Related Patterns<a class=headerlink href=#related-patterns title="Permanent link">&para;</a></h3> <ul> <li>See PATTERNS.md: "System Metadata vs User Content Classification" - NEW pattern added from this discovery</li> <li>Relates to "Graceful Environment Adaptation" (different file handling per environment)</li> <li>Reinforces "Fail-Fast Prerequisite Checking" (but needs correct semantic classification)</li> </ul> <h3 id=impact>Impact<a class=headerlink href=#impact title="Permanent link">&para;</a></h3> <ul> <li><strong>Affects</strong>: All deployments where <code>.version</code> or other system metadata has uncommitted changes</li> <li><strong>Frequency</strong>: Common after updates (<code>.version</code> auto-updated but not committed)</li> <li><strong>User Experience</strong>: Confusing "version mismatch" errors despite fresh deployment</li> <li><strong>Fix Priority</strong>: High - breaks user trust in safety system</li> </ul> <h3 id=verification>Verification<a class=headerlink href=#verification title="Permanent link">&para;</a></h3> <p>Test cases added:</p> <ul> <li>Uncommitted <code>.version</code> doesn't trigger conflict warning </li> <li>Uncommitted user content (<code>~/.amplihack/.claude/context/custom.md</code>) DOES trigger warning </li> <li>Deployment proceeds smoothly with modified <code>.version</code> </li> <li>Version mismatch detection still works correctly </li> </ul> <hr> <h2 id=auto-mode-timeout-causing-opus-model-workflow-failures-2025-11-26>Auto Mode Timeout Causing Opus Model Workflow Failures (2025-11-26)<a class=headerlink href=#auto-mode-timeout-causing-opus-model-workflow-failures-2025-11-26 title="Permanent link">&para;</a></h2> <h3 id=problem_1>Problem<a class=headerlink href=#problem_1 title="Permanent link">&para;</a></h3> <p>Opus model was "skipping" workflow steps during auto mode execution. Investigation revealed the 5-minute per-turn timeout was cutting off Opus execution mid-workflow due to extended thinking requirements.</p> <h3 id=root-cause_1>Root Cause<a class=headerlink href=#root-cause_1 title="Permanent link">&para;</a></h3> <p>The default per-turn timeout of 5 minutes was too aggressive for Opus model, which requires extended thinking time. Log analysis showed:</p> <ul> <li><code>Turn 2 timed out after 300.0s</code></li> <li><code>Turn 1 timed out after 600.1s</code></li> </ul> <h3 id=solution-pr-1676>Solution (PR #1676)<a class=headerlink href=#solution-pr-1676 title="Permanent link">&para;</a></h3> <p>Implemented flexible timeout resolution system:</p> <ol> <li><strong>Increased default timeout</strong>: 5 min  30 min</li> <li><strong>Added <code>--no-timeout</code> flag</strong>: Disables timeout entirely using <code>nullcontext()</code></li> <li><strong>Opus auto-detection</strong>: Model names containing "opus" automatically get 60 min timeout</li> <li><strong>Clear priority system</strong>: <code>--no-timeout</code> &gt; explicit &gt; auto-detect &gt; default</li> </ol> <h3 id=key-insight>Key Insight<a class=headerlink href=#key-insight title="Permanent link">&para;</a></h3> <p><strong>Extended thinking models like Opus need significantly longer timeouts.</strong> Auto-detection based on model name provides a good default without requiring users to remember to adjust settings.</p> <h3 id=files-changed>Files Changed<a class=headerlink href=#files-changed title="Permanent link">&para;</a></h3> <ul> <li><code>src/amplihack/cli.py</code>: Added <code>--no-timeout</code> flag and <code>resolve_timeout()</code> function</li> <li><code>src/amplihack/launcher/auto_mode.py</code>: Accept <code>None</code> timeout using <code>nullcontext</code></li> <li><code>tests/unit/test_auto_mode_timeout.py</code>: 19 comprehensive tests</li> <li><code>docs/AUTO_MODE.md</code>: Added timeout configuration documentation</li> </ul> <h2 id=power-steering-session-type-detection-fix-2025-11-25>Power-Steering Session Type Detection Fix (2025-11-25)<a class=headerlink href=#power-steering-session-type-detection-fix-2025-11-25 title="Permanent link">&para;</a></h2> <h3 id=problem_2>Problem<a class=headerlink href=#problem_2 title="Permanent link">&para;</a></h3> <p>Power-steering incorrectly blocking investigation sessions with development-specific checks. Sessions like "Investigate SSH issues" were misclassified as DEVELOPMENT.</p> <h3 id=root-cause_2>Root Cause<a class=headerlink href=#root-cause_2 title="Permanent link">&para;</a></h3> <p><code>detect_session_type()</code> relied solely on tool-based heuristics. Troubleshooting sessions involve Bash commands and doc updates, matching development patterns.</p> <h3 id=solution_1>Solution<a class=headerlink href=#solution_1 title="Permanent link">&para;</a></h3> <p>Added <strong>keyword-based detection</strong> with priority over tool heuristics. Check first 5 user messages for investigation keywords (investigate, troubleshoot, diagnose, debug, analyze).</p> <h3 id=key-learnings_1>Key Learnings<a class=headerlink href=#key-learnings_1 title="Permanent link">&para;</a></h3> <p><strong>User intent (keywords) is more reliable than tool usage patterns</strong> for session classification.</p> <hr> <h2 id=transcripts-system-investigation-2025-11-22>Transcripts System Investigation (2025-11-22)<a class=headerlink href=#transcripts-system-investigation-2025-11-22 title="Permanent link">&para;</a></h2> <h3 id=problem_3>Problem<a class=headerlink href=#problem_3 title="Permanent link">&para;</a></h3> <p>Needed validation of amplihack's transcript architecture vs Microsoft Amplifier approach.</p> <h3 id=key-findings>Key Findings<a class=headerlink href=#key-findings title="Permanent link">&para;</a></h3> <ul> <li><strong>Decision</strong>: Maintain current 2-tier builder architecture</li> <li><strong>Rationale</strong>: Perfect philosophy alignment (30/30) + proven stability</li> <li><strong>Architecture</strong>: ClaudeTranscriptBuilder + CodexTranscriptsBuilder with 4 strategic hooks</li> <li><strong>5 advantages over Amplifier</strong>: Session isolation, human-readable Markdown, fail-safe architecture, original request tracking, zero external dependencies</li> </ul> <h3 id=key-learnings_2>Key Learnings<a class=headerlink href=#key-learnings_2 title="Permanent link">&para;</a></h3> <p>Independent innovation can be better than adopting external patterns. Session isolation beats centralized state.</p> <hr> <h2 id=hook-double-execution-claude-code-bug-2025-11-21>Hook Double Execution - Claude Code Bug (2025-11-21)<a class=headerlink href=#hook-double-execution-claude-code-bug-2025-11-21 title="Permanent link">&para;</a></h2> <h3 id=problem_4>Problem<a class=headerlink href=#problem_4 title="Permanent link">&para;</a></h3> <p>SessionStart and Stop hooks execute <strong>twice per session</strong> with different PIDs.</p> <h3 id=root-cause_3>Root Cause<a class=headerlink href=#root-cause_3 title="Permanent link">&para;</a></h3> <p><strong>Claude Code internal bug #10871</strong> - Hook execution engine spawns two separate processes regardless of configuration. Our config is correct per schema.</p> <h3 id=solution_2>Solution<a class=headerlink href=#solution_2 title="Permanent link">&para;</a></h3> <p><strong>NO CODE FIX AVAILABLE</strong>. Accept duplication as known limitation. Hooks are idempotent, safe but wasteful (~2 seconds per session).</p> <h3 id=key-learnings_3>Key Learnings<a class=headerlink href=#key-learnings_3 title="Permanent link">&para;</a></h3> <ol> <li>Configuration was correct - the <code>"hooks": []</code> wrapper is required by schema</li> <li>Schema validation prevents incorrect "fixes"</li> <li>Upstream bugs affect downstream projects</li> </ol> <p><strong>Tracking</strong>: Claude Code GitHub Issue #10871</p> <hr> <h2 id=statusline-configuration-missing-2025-11-18>StatusLine Configuration Missing (2025-11-18)<a class=headerlink href=#statusline-configuration-missing-2025-11-18 title="Permanent link">&para;</a></h2> <h3 id=problem_5>Problem<a class=headerlink href=#problem_5 title="Permanent link">&para;</a></h3> <p>Custom status line feature fully implemented but never configured during installation.</p> <h3 id=root-cause_4>Root Cause<a class=headerlink href=#root-cause_4 title="Permanent link">&para;</a></h3> <p>Both installation templates (install.sh and uvx_settings_template.json) excluded statusLine configuration.</p> <h3 id=solution-issue-1433>Solution (Issue #1433)<a class=headerlink href=#solution-issue-1433 title="Permanent link">&para;</a></h3> <p>Added statusLine config to both templates with appropriate path formats.</p> <h3 id=key-learnings_4>Key Learnings<a class=headerlink href=#key-learnings_4 title="Permanent link">&para;</a></h3> <p>Feature discoverability requires installation automation. Templates should match feature implementations.</p> <hr> <h2 id=power-steering-path-validation-bug-2025-11-17>Power-Steering Path Validation Bug (2025-11-17)<a class=headerlink href=#power-steering-path-validation-bug-2025-11-17 title="Permanent link">&para;</a></h2> <h3 id=problem_6>Problem<a class=headerlink href=#problem_6 title="Permanent link">&para;</a></h3> <p>Power-steering fails with path validation error. Claude Code stores transcripts in <code>~/.claude/projects/</code> which is outside project root.</p> <h3 id=root-cause_5>Root Cause<a class=headerlink href=#root-cause_5 title="Permanent link">&para;</a></h3> <p><code>_validate_path()</code> too strict - only allows project root and temp directories.</p> <h3 id=solution_3>Solution<a class=headerlink href=#solution_3 title="Permanent link">&para;</a></h3> <p>Whitelist <code>~/.claude/projects/</code> directory in path validation.</p> <h3 id=key-learnings_5>Key Learnings<a class=headerlink href=#key-learnings_5 title="Permanent link">&para;</a></h3> <ol> <li><strong>Agent orchestration works for complex debugging</strong>: Specialized agents (architect, reviewer, security) effectively decomposed the problem</li> <li><strong>Silent failures need specialized detection</strong>: Merge conflicts blocking tools require dedicated diagnostic capabilities</li> <li><strong>Environment parity is critical</strong>: Version mismatches cause significant investigation overhead (20-25 minutes)</li> <li><strong>Pattern recognition accelerates resolution</strong>: Known patterns should be automated</li> <li><strong>Time-to-discovery varies by issue type</strong>: Merge conflicts (10 min) vs version mismatches (25 min)</li> <li><strong>Documentation discipline enables learning</strong>: Having PHILOSOPHY.md, PATTERNS.md available accelerated analysis</li> </ol> <h3 id=prevention>Prevention<a class=headerlink href=#prevention title="Permanent link">&para;</a></h3> <p><strong>Immediate improvements needed</strong>:</p> <ul> <li><strong>CI Diagnostics Agent</strong>: Automated environment comparison and version mismatch detection</li> <li><strong>Silent Failure Detector Agent</strong>: Pre-commit hook validation and merge conflict detection</li> <li><strong>Pattern Recognition Agent</strong>: Automated matching to historical failure patterns</li> </ul> <p><strong>Process improvements</strong>:</p> <ul> <li>Environment comparison should be step 1 in CI failure debugging</li> <li>Check merge conflicts before running any diagnostic tools</li> <li>Use parallel agent execution for faster diagnosis</li> <li>Create pre-flight checks before CI submission</li> </ul> <p><strong>New agent delegation triggers</strong>:</p> <ul> <li>CI failures  CI Diagnostics Agent</li> <li>Silent tool failures  Silent Failure Detector Agent</li> <li>Recurring issues  Pattern Recognition Agent</li> </ul> <p><strong>Target performance</strong>: Reduce 45-minute complex debugging to 20-25 minutes through automation and specialized agents.</p> <hr> <h2 id=claude-trace-uvx-argument-passthrough-issue-2025-09-26>Claude-Trace UVX Argument Passthrough Issue (2025-09-26)<a class=headerlink href=#claude-trace-uvx-argument-passthrough-issue-2025-09-26 title="Permanent link">&para;</a></h2> <h3 id=issue>Issue<a class=headerlink href=#issue title="Permanent link">&para;</a></h3> <p>UVX argument passthrough was failing for claude-trace integration. Commands like <code>uvx --from git+... amplihack -- -p "prompt"</code> would launch interactively instead of executing the prompt directly, forcing users to manually enter prompts.</p> <h3 id=root-cause_6>Root Cause<a class=headerlink href=#root-cause_6 title="Permanent link">&para;</a></h3> <p><strong>Misdiagnosis Initially</strong>: Thought issue was with UVX argument parsing, but <code>parse_args_with_passthrough()</code> was working correctly.</p> <p><strong>Actual Root Cause</strong>: Command building logic in <code>ClaudeLauncher.build_claude_command()</code> wasn't handling claude-trace syntax properly. Claude-trace requires different command structure:</p> <ul> <li><strong>Standard claude</strong>: <code>claude --dangerously-skip-permissions -p "prompt"</code></li> <li><strong>Claude-trace</strong>: <code>claude-trace --run-with chat --dangerously-skip-permissions -p "prompt"</code></li> </ul> <p>The key difference is claude-trace needs <code>--run-with chat</code> before Claude arguments.</p> <h3 id=solution_4>Solution<a class=headerlink href=#solution_4 title="Permanent link">&para;</a></h3> <p>Modified <code>src/amplihack/launcher/core.py</code> in <code>build_claude_command()</code> method:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>if</span> <span class=n>claude_binary</span> <span class=o>==</span> <span class=s2>&quot;claude-trace&quot;</span><span class=p>:</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>    <span class=c1># claude-trace requires --run-with followed by the command and arguments</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=c1># Format: claude-trace --run-with chat [claude-args...]</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=n>cmd</span> <span class=o>=</span> <span class=p>[</span><span class=n>claude_binary</span><span class=p>,</span> <span class=s2>&quot;--run-with&quot;</span><span class=p>,</span> <span class=s2>&quot;chat&quot;</span><span class=p>]</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>    <span class=c1># Add Claude arguments after the command</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>    <span class=n>cmd</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&quot;--dangerously-skip-permissions&quot;</span><span class=p>)</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>    <span class=c1># Add system prompt, --add-dir, and forwarded arguments...</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>claude_args</span><span class=p>:</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>        <span class=n>cmd</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>claude_args</span><span class=p>)</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>    <span class=k>return</span> <span class=n>cmd</span>
</span></code></pre></div> <h3 id=key-learnings_6>Key Learnings<a class=headerlink href=#key-learnings_6 title="Permanent link">&para;</a></h3> <ol> <li><strong>Tool-specific syntax matters</strong>: Different tools (claude vs claude-trace) may require completely different argument structures even when functionally equivalent</li> <li><strong>Debugging scope</strong>: Initially focused on argument parsing when the issue was in command building - trace through the entire pipeline</li> <li><strong>Integration complexity</strong>: Claude-trace integration adds syntax complexity that must be handled explicitly</li> <li><strong>Testing real scenarios</strong>: Mock testing wasn't sufficient - needed actual UVX deployment testing to catch this</li> <li><strong>Command structure precedence</strong>: Some tools require specific argument ordering (--run-with must come before other args)</li> </ol> <h3 id=prevention_1>Prevention<a class=headerlink href=#prevention_1 title="Permanent link">&para;</a></h3> <ul> <li><strong>Always test real deployment scenarios</strong>: Don't rely only on local testing when tools have different deployment contexts</li> <li><strong>Document tool-specific syntax requirements</strong>: Create clear examples for each supported execution mode</li> <li><strong>Test command building separately</strong>: Unit test command construction logic independently from argument parsing</li> <li><strong>Integration testing</strong>: Include UVX deployment testing in CI/CD pipeline</li> <li><strong>Clear error messages</strong>: Provide better feedback when argument passthrough fails</li> </ul> <h3 id=pattern-recognition>Pattern Recognition<a class=headerlink href=#pattern-recognition title="Permanent link">&para;</a></h3> <p><strong>Trigger Signs of Command Structure Issues:</strong></p> <ul> <li>Arguments parsed correctly but command fails silently</li> <li>Tool works interactively but not with arguments</li> <li>Different behavior between direct execution and wrapper tools</li> <li>Integration tools requiring specific argument ordering</li> </ul> <p><strong>Debugging Approach:</strong> When argument passthrough fails:</p> <ol> <li>Verify argument parsing is working (log parsed args)</li> <li>Check command building logic (log generated command)</li> <li>Test command manually to isolate syntax issues</li> <li>Compare tool documentation for syntax differences</li> </ol> <h3 id=testing-validation>Testing Validation<a class=headerlink href=#testing-validation title="Permanent link">&para;</a></h3> <p>All scenarios now working:</p> <ul> <li> <code>uvx amplihack -- --help</code> (shows Claude help)</li> <li> <code>uvx amplihack -- -p "Hello world"</code> (executes prompt)</li> <li> <code>uvx amplihack -- --model claude-3-opus-20240229 -p "test"</code> (model + prompt)</li> </ul> <p><strong>Issue</strong>: #149 <strong>PR</strong>: #150 <strong>Branch</strong>: <code>feat/issue-149-uvx-argument-passthrough</code></p> <hr> <h2 id=socratic-questioning-pattern-for-knowledge-exploration-2025-10-18>Socratic Questioning Pattern for Knowledge Exploration (2025-10-18)<a class=headerlink href=#socratic-questioning-pattern-for-knowledge-exploration-2025-10-18 title="Permanent link">&para;</a></h2> <h3 id=issue_1>Issue<a class=headerlink href=#issue_1 title="Permanent link">&para;</a></h3> <p>Need effective method for generating deep, probing questions that challenge technical claims and surface hidden assumptions in knowledge-builder scenarios.</p> <h3 id=root-cause_7>Root Cause<a class=headerlink href=#root-cause_7 title="Permanent link">&para;</a></h3> <p>Simple question generation often produces shallow inquiries that can be deflected or answered superficially. Effective Socratic questioning requires strategic multi-dimensional attack on claims combined with formal precision.</p> <h3 id=solution_5>Solution<a class=headerlink href=#solution_5 title="Permanent link">&para;</a></h3> <p><strong>Three-Dimensional Question Attack Strategy</strong>:</p> <ol> <li><strong>Empirical Dimension</strong>: Challenge with observable evidence and historical outcomes</li> <li>Example: "Why do memory safety bugs persist despite 30 years of tool development?"</li> <li>Grounds abstract claims in reality</li> <li> <p>Hard to dismiss as "merely theoretical"</p> </li> <li> <p><strong>Computational Dimension</strong>: Probe tractability and complexity</p> </li> <li>Example: "Does manual discipline require solving NP-complete problems in your head?"</li> <li>Connects theory to practical cognitive limitations</li> <li> <p>Reveals fundamental constraints</p> </li> <li> <p><strong>Formal Mathematical Dimension</strong>: Demand precise relationships</p> </li> <li>Example: "Is the relationship bijective or a subset? What's lost?"</li> <li>Forces rigorous thinking</li> <li>Prevents vague equivalence claims</li> </ol> <p><strong>Key Techniques</strong>:</p> <ul> <li>Use formal language (bijective, NP-complete) to force precision</li> <li>Embed context within questions to prevent deflection</li> <li>Connect theoretical claims to observable outcomes</li> <li>Attack different aspects of claim simultaneously (cannot defend all fronts equally)</li> </ul> <h3 id=key-learnings_7>Key Learnings<a class=headerlink href=#key-learnings_7 title="Permanent link">&para;</a></h3> <ol> <li><strong>Multi-dimensional attack is more effective than single-angle questioning</strong> - Forces comprehensive defense</li> <li><strong>Formal language prevents hand-waving</strong> - "Bijective" demands precision that "similar" doesn't</li> <li><strong>Empirical grounding matters</strong> - Observable outcomes harder to dismiss than pure theory</li> <li><strong>Question length/complexity tradeoff</strong> - Longer questions with embedded context are acceptable for deep exploration</li> <li><strong>Pattern is domain-agnostic</strong> - Works for technical debates, philosophical claims, design decisions</li> </ol> <h3 id=usage-context>Usage Context<a class=headerlink href=#usage-context title="Permanent link">&para;</a></h3> <p><strong>When to Use</strong>:</p> <ul> <li>Knowledge-builder agent scenarios requiring deep exploration</li> <li>Challenging technical or philosophical claims</li> <li>Surfacing hidden assumptions in design decisions</li> <li>Teaching critical thinking through guided inquiry</li> </ul> <p><strong>When NOT to Use</strong>:</p> <ul> <li>Simple factual questions (overkill)</li> <li>Time-sensitive decisions (too slow)</li> <li>Consensus-building conversations (too confrontational)</li> </ul> <h3 id=evidence-status>Evidence Status<a class=headerlink href=#evidence-status title="Permanent link">&para;</a></h3> <p><strong>Proven</strong>: 1 successful usage (memory safety ownership vs. discipline debate) <strong>Needs</strong>: 2-3 more successful applications before promoting to PATTERNS.md <strong>Next Test</strong>: Use with knowledge-builder agent in actual knowledge exploration scenario</p> <h3 id=prevention_2>Prevention<a class=headerlink href=#prevention_2 title="Permanent link">&para;</a></h3> <p><strong>To implement effectively</strong>:</p> <ul> <li>Test pattern 2-3 more times in varied contexts</li> <li>Validate with knowledge-builder agent integration</li> <li>Refine based on actual usage feedback</li> <li>Consider adding to PATTERNS.md after sufficient validation</li> </ul> <p><strong>Trigger Signs for Pattern Use</strong>:</p> <ul> <li>User makes strong equivalence claim ("X is just Y")</li> <li>Need to explore assumptions systematically</li> <li>Goal is deep understanding, not quick answers</li> <li>Conversational context allows longer-form inquiry</li> </ul> <hr> <h2 id=pattern-applicability-analysis-framework-2025-10-20>Pattern Applicability Analysis Framework (2025-10-20)<a class=headerlink href=#pattern-applicability-analysis-framework-2025-10-20 title="Permanent link">&para;</a></h2> <h3 id=discovery>Discovery<a class=headerlink href=#discovery title="Permanent link">&para;</a></h3> <p>Through analysis of PBZFT vs N-Version Programming decision, identified six reusable meta-patterns for evaluating when to adopt patterns from other domains, particularly distributed systems patterns applied to AI agent systems.</p> <h3 id=context>Context<a class=headerlink href=#context title="Permanent link">&para;</a></h3> <p>Considered implementing PBZFT (Practical Byzantine Fault Tolerance) as new amplihack pattern after comparison with existing N-Version Programming approach. Analysis revealed PBZFT would be 6-9x more complex with zero benefit, leading to systematic exploration of WHY this mismatch occurred and how to prevent similar mistakes.</p> <h3 id=pattern-1-threat-model-precision-principle>Pattern 1: Threat Model Precision Principle<a class=headerlink href=#pattern-1-threat-model-precision-principle title="Permanent link">&para;</a></h3> <p><strong>Core Insight</strong>: Fault tolerance mechanisms are only effective when matched to correct threat model. Mismatched defenses add complexity without benefit.</p> <p><strong>Decision Framework</strong>:</p> <ol> <li>Identify actual failure mode (what really breaks?)</li> <li>Classify threat type: Honest mistakes vs Malicious intent</li> <li>Match defense mechanism to threat type</li> <li>Reject mechanisms designed for different threats</li> </ol> <p><strong>Evidence</strong>:</p> <ul> <li>PBZFT defends against Byzantine failures (malicious nodes) - not our threat</li> <li>N-Version defends against independent errors (honest mistakes) - our actual threat</li> <li>Voting defends against adversaries; expert review catches quality issues</li> </ul> <p><strong>Anti-Pattern</strong>: Applying "industry standard" solutions without verifying threat match</p> <h3 id=pattern-2-voting-vs-expert-judgment-selection-criteria>Pattern 2: Voting vs Expert Judgment Selection Criteria<a class=headerlink href=#pattern-2-voting-vs-expert-judgment-selection-criteria title="Permanent link">&para;</a></h3> <p><strong>Core Insight</strong>: Voting and expert judgment serve fundamentally different purposes and produce different quality outcomes.</p> <p><strong>When Voting Works</strong>:</p> <ul> <li>Adversarial environment (can't trust individual nodes)</li> <li>Binary or simple discrete choices</li> <li>No objective quality metric available</li> <li>Consensus more valuable than correctness</li> </ul> <p><strong>When Expert Judgment Works</strong>:</p> <ul> <li>Cooperative environment (honest actors)</li> <li>Complex quality dimensions (code quality, architecture)</li> <li>Objective evaluation criteria exist</li> <li>Correctness more valuable than consensus</li> </ul> <p><strong>Evidence</strong>:</p> <ul> <li>Code quality has measurable dimensions (complexity, maintainability, correctness)</li> <li>Expert review provides detailed feedback ("Fix this specific issue")</li> <li>Voting provides only rejection ("This is wrong") without guidance</li> <li>N-Version achieves 30-65% error reduction through diversity, not voting</li> </ul> <p><strong>Application</strong>: Code review, architectural decisions, security audits all benefit from expert judgment over democratic voting.</p> <h3 id=pattern-3-distributed-systems-pattern-applicability-test>Pattern 3: Distributed Systems Pattern Applicability Test<a class=headerlink href=#pattern-3-distributed-systems-pattern-applicability-test title="Permanent link">&para;</a></h3> <p><strong>Core Insight</strong>: Many distributed systems patterns don't apply to AI agent systems due to different coordination models and failure characteristics.</p> <p><strong>Critical Differences</strong>:</p> <table> <thead> <tr> <th>Dimension</th> <th>Distributed Systems</th> <th>AI Agent Systems</th> </tr> </thead> <tbody> <tr> <td>Node Behavior</td> <td>Can be malicious</td> <td>Honest but imperfect</td> </tr> <tr> <td>Failure Mode</td> <td>Byzantine faults</td> <td>Independent errors</td> </tr> <tr> <td>Coordination</td> <td>Explicit consensus</td> <td>Implicit through design</td> </tr> <tr> <td>Communication</td> <td>Messages, network</td> <td>Shared specifications</td> </tr> <tr> <td>Trust Model</td> <td>Zero-trust</td> <td>Cooperative</td> </tr> </tbody> </table> <p><strong>Applicability Test Questions</strong>:</p> <ol> <li>Does pattern assume adversarial nodes? (Usually doesn't apply to AI)</li> <li>Does pattern solve network partition issues? (AI agents share state)</li> <li>Does pattern require message passing? (AI agents use shared context)</li> <li>Does pattern optimize for communication cost? (AI has different cost model)</li> </ol> <p><strong>Patterns That DO Apply to AI</strong>:</p> <ul> <li>Load balancing (parallel agent execution)</li> <li>Caching (memoization, state management)</li> <li>Event-driven architecture (hooks, triggers)</li> <li>Circuit breakers (fallback strategies)</li> </ul> <p><strong>Patterns That DON'T Apply to AI</strong>:</p> <ul> <li>Byzantine consensus (PBZFT, blockchain)</li> <li>CAP theorem considerations (no network partitions)</li> <li>Gossip protocols (agents don't need eventual consistency)</li> <li>Quorum systems (voting inferior to expert review)</li> </ul> <h3 id=pattern-4-complexity-benefit-trade-off-quantification>Pattern 4: Complexity-Benefit Trade-off Quantification<a class=headerlink href=#pattern-4-complexity-benefit-trade-off-quantification title="Permanent link">&para;</a></h3> <p><strong>Core Insight</strong>: Complex solutions must provide proportional benefit. Simple metrics reveal when complexity is unjustified.</p> <p><strong>Quantification Framework</strong>:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>Complexity Cost = (Lines of Code)  (Conceptual Overhead)  (Integration Points)
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>Benefit Gain = (Problem Solved)  (Quality Improvement)  (Risk Reduction)
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>Justified Complexity: Benefit Gain / Complexity Cost &gt; 3.0
</span></code></pre></div> <p><strong>Evidence</strong>:</p> <ul> <li>PBZFT: 6-9x complexity increase, 0x benefit (solves non-existent problem)</li> <li>N-Version: 2x complexity increase, 30-65% error reduction</li> </ul> <p><strong>Red Flags for Unjustified Complexity</strong>:</p> <ul> <li>Complexity ratio &gt; 3x with no measurable benefit</li> <li>Solution requires understanding concepts not needed elsewhere</li> <li>Implementation needs extensive documentation to explain</li> <li>"Industry best practice" argument without context validation</li> </ul> <h3 id=pattern-5-domain-appropriateness-check-for-best-practices>Pattern 5: Domain Appropriateness Check for "Best Practices"<a class=headerlink href=#pattern-5-domain-appropriateness-check-for-best-practices title="Permanent link">&para;</a></h3> <p><strong>Core Insight</strong>: Best practices from one domain can be anti-patterns in another. Always validate domain appropriateness before adopting.</p> <p><strong>Validation Checklist</strong>:</p> <ul> <li>Does this practice solve a problem that exists in MY domain?</li> <li>Does my domain have same threat model as source domain?</li> <li>Are constraints that drove this practice present in my system?</li> <li>What was original context that made this "best"?</li> <li>Has this been proven effective in contexts similar to mine?</li> </ul> <p><strong>Common Cross-Domain Misapplications</strong>:</p> <ul> <li>Microservices patterns  Monolithic apps (unnecessary distribution)</li> <li>Blockchain consensus  Database systems (unnecessary Byzantine tolerance)</li> <li>Military security  Consumer apps (disproportionate paranoia)</li> <li>Enterprise architecture  Startups (premature abstraction)</li> </ul> <p><strong>Protection Strategy</strong>:</p> <ol> <li>Ask: "What problem does this solve in THAT domain?"</li> <li>Verify: "Do I have that same problem?"</li> <li>Question: "What are costs of importing this pattern?"</li> <li>Consider: "Is there simpler solution that fits MY constraints?"</li> </ol> <h3 id=pattern-6-diversity-as-error-reduction-mechanism>Pattern 6: Diversity as Error Reduction Mechanism<a class=headerlink href=#pattern-6-diversity-as-error-reduction-mechanism title="Permanent link">&para;</a></h3> <p><strong>Core Insight</strong>: Independent diverse implementations naturally reduce correlated errors without requiring voting or consensus mechanisms.</p> <p><strong>How Diversity Works</strong>:</p> <ul> <li>N diverse implementations of same specification</li> <li>Each has probability p of independent error</li> <li>Probability of same error in all N: p^N (exponential reduction)</li> <li>No voting required - diversity itself provides value</li> </ul> <p><strong>Evidence</strong>:</p> <ul> <li>N-Version provides 30-65% error reduction through diversity alone</li> <li>PBZFT's voting adds complexity without increasing diversity benefit</li> <li>Expert review can select best implementation after diversity generation</li> </ul> <p><strong>Application to AI Agents</strong>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># Generate diverse implementations</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=n>implementations</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    <span class=n>agent1</span><span class=o>.</span><span class=n>generate</span><span class=p>(</span><span class=n>spec</span><span class=p>),</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=n>agent2</span><span class=o>.</span><span class=n>generate</span><span class=p>(</span><span class=n>spec</span><span class=p>),</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=n>agent3</span><span class=o>.</span><span class=n>generate</span><span class=p>(</span><span class=n>spec</span><span class=p>),</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=p>]</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=c1># Expert review selects best (not voting)</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=n>best</span> <span class=o>=</span> <span class=n>expert_reviewer</span><span class=o>.</span><span class=n>select_best</span><span class=p>(</span><span class=n>implementations</span><span class=p>,</span> <span class=n>criteria</span><span class=p>)</span>
</span></code></pre></div> <p><strong>When Diversity Fails</strong>:</p> <ul> <li>Specifications are ambiguous (correlated errors from misunderstanding)</li> <li>Common dependencies (same libraries, same bugs)</li> <li>Shared misconceptions (all agents trained on similar data)</li> </ul> <h3 id=meta-pattern-systematic-pattern-applicability-analysis>Meta-Pattern: Systematic Pattern Applicability Analysis<a class=headerlink href=#meta-pattern-systematic-pattern-applicability-analysis title="Permanent link">&para;</a></h3> <p><strong>Five-Phase Framework</strong> for evaluating pattern adoption:</p> <p><strong>Phase 1: Threat Model Match</strong></p> <ul> <li>Identify actual failure modes in target system</li> <li>Identify pattern's target failure modes</li> <li>Verify failure modes match</li> <li>If mismatch, REJECT pattern</li> </ul> <p><strong>Phase 2: Mechanism Appropriateness</strong></p> <ul> <li>Does pattern use voting? (Usually wrong for quality assessment)</li> <li>Does pattern assume adversarial behavior? (Usually wrong for AI)</li> <li>Does pattern optimize for network communication? (Usually irrelevant for AI)</li> <li>Does pattern solve target domain's specific problem?</li> </ul> <p><strong>Phase 3: Complexity Justification</strong></p> <ul> <li>Calculate complexity increase (lines, concepts, integration points)</li> <li>Measure benefit gain (error reduction, risk mitigation)</li> <li>Verify benefit/complexity ratio &gt; 3.0</li> <li>If ratio &lt; 3.0, seek simpler alternatives</li> </ul> <p><strong>Phase 4: Domain Validation</strong></p> <ul> <li>Research pattern's origin domain</li> <li>Understand original context and constraints</li> <li>Verify target domain shares those characteristics</li> <li>Check for successful applications in similar domains</li> </ul> <p><strong>Phase 5: Alternative Exploration</strong></p> <ul> <li>Brainstorm domain-native solutions</li> <li>Can simpler mechanisms achieve same benefits?</li> <li>What would "ruthless simplicity" approach look like?</li> <li>Can you get 80% of benefit with 20% of complexity?</li> </ul> <h3 id=key-learnings_8>Key Learnings<a class=headerlink href=#key-learnings_8 title="Permanent link">&para;</a></h3> <ol> <li><strong>Threat model mismatch is primary source of inappropriate pattern adoption</strong> - Always verify failure modes match before importing patterns</li> <li><strong>Voting and expert judgment are not interchangeable</strong> - Code quality requires expert review, not democratic voting</li> <li><strong>Distributed systems patterns rarely map to AI systems</strong> - Different trust models, coordination mechanisms, and failure characteristics</li> <li><strong>Complexity must be proportionally justified</strong> - 3:1 benefit-to-cost ratio minimum for adopting complex patterns</li> <li><strong>Best practices are domain-specific</strong> - What's "best" in blockchain may be anti-pattern for AI agents</li> <li><strong>Diversity reduces errors without consensus overhead</strong> - N-Version's power comes from diversity, not voting</li> </ol> <h3 id=prevention_3>Prevention<a class=headerlink href=#prevention_3 title="Permanent link">&para;</a></h3> <p><strong>Before adopting any pattern from another domain:</strong></p> <ol> <li>Run through five-phase applicability analysis</li> <li>Verify threat model match as first step</li> <li>Calculate complexity-to-benefit ratio</li> <li>Question "industry best practice" claims</li> <li>Explore domain-native alternatives</li> <li>Default to ruthless simplicity unless complexity clearly justified</li> </ol> <p><strong>Red Flags Requiring Deep Analysis</strong>:</p> <ul> <li>Pattern from adversarial domain (blockchain, security)  cooperative domain (AI agents)</li> <li>Pattern optimizes for constraints not present in target (network latency, Byzantine nodes)</li> <li>Complexity increase &gt; 3x without measurable benefit</li> <li>"Everyone uses this" without context-specific validation</li> </ul> <h3 id=integration-with-existing-philosophy>Integration with Existing Philosophy<a class=headerlink href=#integration-with-existing-philosophy title="Permanent link">&para;</a></h3> <p>This discovery strengthens and validates existing principles:</p> <ul> <li><strong>Ruthless Simplicity</strong> (PHILOSOPHY.md): Complexity must justify existence</li> <li><strong>Zero-BS Implementation</strong> (PHILOSOPHY.md): No solutions for non-existent problems</li> <li><strong>Question Everything</strong> (PHILOSOPHY.md): Challenge "best practices" without validation</li> <li><strong>Necessity First</strong> (PHILOSOPHY.md): "Do we actually need this right now?"</li> </ul> <h3 id=files-referenced>Files Referenced<a class=headerlink href=#files-referenced title="Permanent link">&para;</a></h3> <ul> <li>PBZFT Analysis: <code>~/.amplihack/.claude/runtime/logs/[session]/pbzft_analysis.md</code></li> <li>N-Version Pattern: Already implemented in amplihack</li> <li>Threat Modeling: Aligns with security agent principles</li> <li>Complexity Analysis: Informed by PHILOSOPHY.md simplicity mandate</li> </ul> <h3 id=next-steps>Next Steps<a class=headerlink href=#next-steps title="Permanent link">&para;</a></h3> <ol> <li><strong>Apply pattern applicability framework</strong> when evaluating future pattern adoptions</li> <li><strong>Create checklist tool</strong> for systematic pattern evaluation</li> <li><strong>Document known anti-patterns</strong> from inappropriate domain transfers</li> <li><strong>Strengthen agent instructions</strong> to question pattern applicability before implementation</li> </ol> <h3 id=related-patterns_1>Related Patterns<a class=headerlink href=#related-patterns_1 title="Permanent link">&para;</a></h3> <ul> <li>Connects to "Ruthless Simplicity" (PHILOSOPHY.md)</li> <li>Enhances "Decision-Making Framework" (PHILOSOPHY.md)</li> <li>Validates "Question Everything" principle</li> <li>Extends pattern recognition capabilities</li> </ul> <hr> <h2 id=massive-parallel-reflection-workstream-execution-2025-11-05>Massive Parallel Reflection Workstream Execution (2025-11-05)<a class=headerlink href=#massive-parallel-reflection-workstream-execution-2025-11-05 title="Permanent link">&para;</a></h2> <h3 id=context_1>Context<a class=headerlink href=#context_1 title="Permanent link">&para;</a></h3> <p>Successfully executed 13 parallel full-workflow tasks simultaneously, converting reflection system findings into GitHub issues and implementing solutions. This represented the largest parallel agent execution to date, demonstrating the scalability and robustness of the workflow system.</p> <h3 id=discovery_1>Discovery<a class=headerlink href=#discovery_1 title="Permanent link">&para;</a></h3> <p><strong>Parallel Execution at Scale Works</strong>: Successfully managed 13 concurrent feature implementations (issues #1089-#1101) using worktree isolation, each following the complete 13-step workflow from planning through PR creation.</p> <p><strong>Key Metrics:</strong></p> <ul> <li>13 issues created from reflection analysis</li> <li>13 feature branches via git worktrees</li> <li>13 PRs created with 9-10/10 philosophy compliance</li> <li>7 message reduction features addressing real pain points</li> <li>100% success rate (no failed workflows)</li> </ul> <h3 id=root-cause-analysis>Root Cause Analysis<a class=headerlink href=#root-cause-analysis title="Permanent link">&para;</a></h3> <p><strong>Why This Succeeded:</strong></p> <ol> <li><strong>Worktree Isolation</strong>: Each feature in separate worktree prevented cross-contamination</li> <li>Branch: <code>feat/issue-{number}-{description}</code></li> <li>Location: <code>/tmp/worktree-issue-{number}</code></li> <li> <p>No merge conflicts between parallel operations</p> </li> <li> <p><strong>Agent Specialization</strong>: Each workflow step delegated to appropriate agents</p> </li> <li>prompt-writer: Requirements clarification</li> <li>architect: Design specifications</li> <li>builder: Implementation</li> <li>reviewer: Quality assurance</li> <li> <p>fix-agent: Conflict resolution</p> </li> <li> <p><strong>Fix-Agent Pattern</strong>: Systematic conflict resolution using templates</p> </li> <li>Cherry-pick strategy for divergent branches</li> <li>Pattern-based resolution (import, config, quality)</li> <li> <p>Quick mode for common issues</p> </li> <li> <p><strong>Documentation-First Approach</strong>: Templates and workflows provided clear guidance</p> </li> <li>Message templates (~/.amplihack/.claude/data/message_templates/)</li> <li>Fix templates (~/.amplihack/.claude/data/fix_templates/)</li> <li>Workflow documentation (docs/workflows/)</li> </ol> <h3 id=solution-patterns-that-worked>Solution Patterns That Worked<a class=headerlink href=#solution-patterns-that-worked title="Permanent link">&para;</a></h3> <p><strong>1. Worktree Management Pattern:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># Create isolated workspace</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>git<span class=w> </span>worktree<span class=w> </span>add<span class=w> </span>/tmp/worktree-issue-<span class=o>{</span>N<span class=o>}</span><span class=w> </span>-b<span class=w> </span>feat/issue-<span class=o>{</span>N<span class=o>}</span>-<span class=o>{</span>description<span class=o>}</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=c1># Work independently</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=nb>cd</span><span class=w> </span>/tmp/worktree-issue-<span class=o>{</span>N<span class=o>}</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=c1># ... implement feature ...</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=c1># Push and create PR</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>git<span class=w> </span>push<span class=w> </span>-u<span class=w> </span>origin<span class=w> </span>feat/issue-<span class=o>{</span>N<span class=o>}</span>-<span class=o>{</span>description<span class=o>}</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>gh<span class=w> </span>pr<span class=w> </span>create<span class=w> </span>--title<span class=w> </span><span class=s2>&quot;...&quot;</span><span class=w> </span>--body<span class=w> </span><span class=s2>&quot;...&quot;</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=c1># Cleanup</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=nb>cd</span><span class=w> </span>/home/azureuser/src/MicrosoftHackathon2025-AgenticCoding
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>git<span class=w> </span>worktree<span class=w> </span>remove<span class=w> </span>/tmp/worktree-issue-<span class=o>{</span>N<span class=o>}</span>
</span></code></pre></div> <p><strong>2. Cherry-Pick Conflict Resolution:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># When branches diverge from main</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>git<span class=w> </span>fetch<span class=w> </span>origin<span class=w> </span>main
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>git<span class=w> </span>cherry-pick<span class=w> </span>origin/main
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=c1># Resolve conflicts systematically</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>/fix<span class=w> </span>import<span class=w>   </span><span class=c1># Dependency issues</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>/fix<span class=w> </span>config<span class=w>   </span><span class=c1># Configuration updates</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>/fix<span class=w> </span>quality<span class=w>  </span><span class=c1># Formatting and style</span>
</span></code></pre></div> <p><strong>3. Message Reduction Features (High Value):</strong></p> <ul> <li>Budget awareness warnings (prevent token exhaustion)</li> <li>Complexity estimator (right-size responses)</li> <li>Message consolidation (reduce API calls)</li> <li>Context prioritization (focus on relevant info)</li> <li>Summary generation (compress long threads)</li> <li>Progressive disclosure (hide verbose output)</li> <li>Smart truncation (preserve key information)</li> </ul> <h3 id=key-learnings_9>Key Learnings<a class=headerlink href=#key-learnings_9 title="Permanent link">&para;</a></h3> <ol> <li><strong>Parallel Agent Execution is Highly Effective</strong></li> <li>Independent tasks can run simultaneously without interference</li> <li>Worktrees provide perfect isolation mechanism</li> <li>No performance degradation with 13 parallel workflows</li> <li> <p>Agent specialization maintains quality at scale</p> </li> <li> <p><strong>Fix-Agent Pattern Scales Well</strong></p> </li> <li>Template-based resolution handles common patterns</li> <li>Cherry-pick strategy effective for divergent branches</li> <li>Pattern recognition accelerates conflict resolution</li> <li> <p>Systematic approach prevents mistakes under pressure</p> </li> <li> <p><strong>Documentation-First is Lightweight and Effective</strong></p> </li> <li>Templates reduce decision overhead</li> <li>Workflows provide clear process guidance</li> <li>Documentation faster than code generation</li> <li> <p>Reusable across multiple features</p> </li> <li> <p><strong>Message Reduction Features Address Real Pain Points</strong></p> </li> <li>Token budget exhaustion is frequent blocker</li> <li>Response complexity often mismatched to need</li> <li>API call volume impacts performance</li> <li> <p>Users need more control over verbosity</p> </li> <li> <p><strong>Philosophy Compliance Remains High at Scale</strong></p> </li> <li>All 13 PRs scored 9-10/10</li> <li>Ruthless simplicity maintained</li> <li>Zero-BS implementation enforced</li> <li> <p>Modular design preserved</p> </li> <li> <p><strong>Reflection System Generates Actionable Insights</strong></p> </li> <li>Identified 13 concrete improvement opportunities</li> <li>Each mapped to specific user pain points</li> <li>Clear implementation paths</li> <li>Measurable impact potential</li> </ol> <h3 id=impact_1>Impact<a class=headerlink href=#impact_1 title="Permanent link">&para;</a></h3> <p><strong>Demonstrates System Scalability:</strong></p> <ul> <li>Workflow handles 13+ concurrent tasks without degradation</li> <li>Agent orchestration remains effective at scale</li> <li>Quality standards maintained across all implementations</li> <li>Process is repeatable and systematic</li> </ul> <p><strong>Validates Architecture Decisions:</strong></p> <ul> <li>Worktree isolation strategy proven</li> <li>Agent specialization approach validated</li> <li>Fix-agent pattern confirmed effective</li> <li>Documentation-first approach successful</li> </ul> <p><strong>Identifies Improvement Opportunities:</strong></p> <ul> <li>Message reduction features fill real gaps</li> <li>Token budget management needs better tooling</li> <li>Response complexity should be tunable</li> <li>API call optimization has significant value</li> </ul> <h3 id=prevention-patterns>Prevention Patterns<a class=headerlink href=#prevention-patterns title="Permanent link">&para;</a></h3> <p><strong>For Future Parallel Execution:</strong></p> <ol> <li><strong>Always Use Worktrees for Parallel Work</strong></li> <li>One worktree per feature/issue</li> <li>Prevents branch interference</li> <li>Enables true parallel development</li> <li> <p>Easy cleanup with <code>git worktree remove</code></p> </li> <li> <p><strong>Cherry-Pick for Divergent Branches</strong></p> </li> <li>When branches diverge from main</li> <li>Systematic conflict resolution</li> <li>Preserves both lineages</li> <li> <p>Better than rebase for parallel work</p> </li> <li> <p><strong>Use Fix-Agent for Systematic Resolution</strong></p> </li> <li>Pattern-based conflict handling</li> <li>Template-driven solutions</li> <li>Quick mode for common issues</li> <li> <p>Diagnostic mode for complex problems</p> </li> <li> <p><strong>Document Templates Before Mass Changes</strong></p> </li> <li>Create reusable message templates</li> <li>Document fix patterns</li> <li>Write workflow guides</li> <li>Templates save time at scale</li> </ol> <h3 id=files-modifiedcreated>Files Modified/Created<a class=headerlink href=#files-modifiedcreated title="Permanent link">&para;</a></h3> <p><strong>Issues Created:</strong></p> <ul> <li> <h1 id=1089-budget-awareness-warnings>1089: Budget awareness warnings<a class=headerlink href=#1089-budget-awareness-warnings title="Permanent link">&para;</a></h1> </li> <li> <h1 id=1090-message-complexity-estimator>1090: Message complexity estimator<a class=headerlink href=#1090-message-complexity-estimator title="Permanent link">&para;</a></h1> </li> <li> <h1 id=1091-message-consolidation>1091: Message consolidation<a class=headerlink href=#1091-message-consolidation title="Permanent link">&para;</a></h1> </li> <li> <h1 id=1092-context-prioritization>1092: Context prioritization<a class=headerlink href=#1092-context-prioritization title="Permanent link">&para;</a></h1> </li> <li> <h1 id=1093-summary-generation>1093: Summary generation<a class=headerlink href=#1093-summary-generation title="Permanent link">&para;</a></h1> </li> <li> <h1 id=1094-progressive-disclosure>1094: Progressive disclosure<a class=headerlink href=#1094-progressive-disclosure title="Permanent link">&para;</a></h1> </li> <li> <h1 id=1095-smart-truncation>1095: Smart truncation<a class=headerlink href=#1095-smart-truncation title="Permanent link">&para;</a></h1> </li> <li> <h1 id=1096-1101-additional-improvements>1096-#1101: Additional improvements<a class=headerlink href=#1096-1101-additional-improvements title="Permanent link">&para;</a></h1> </li> </ul> <p><strong>PRs Created (all with 9-10/10 philosophy compliance):</strong></p> <ul> <li>PR #1102-#1114: Feature implementations</li> </ul> <p><strong>Templates Created:</strong></p> <ul> <li><code>~/.amplihack/.claude/data/message_templates/</code> (various)</li> <li><code>~/.amplihack/.claude/data/fix_templates/</code> (import, config, quality, etc.)</li> </ul> <p><strong>Workflows Documented:</strong></p> <ul> <li><code>docs/workflows/parallel_execution.md</code></li> <li><code>docs/workflows/worktree_management.md</code></li> <li><code>docs/workflows/conflict_resolution.md</code></li> </ul> <h3 id=related-patterns_2>Related Patterns<a class=headerlink href=#related-patterns_2 title="Permanent link">&para;</a></h3> <p><strong>Enhances Existing Patterns:</strong></p> <ul> <li>Microsoft Amplifier Parallel Execution Engine (CLAUDE.md)</li> <li>Parallel execution templates and protocols</li> <li>Agent delegation strategy</li> <li>Fix-agent workflow optimization</li> </ul> <p><strong>Validates Philosophy Principles:</strong></p> <ul> <li>Ruthless Simplicity: Maintained at scale</li> <li>Modular Design: Bricks &amp; studs approach works</li> <li>Zero-BS Implementation: No shortcuts taken</li> <li>Agent Delegation: Orchestration over implementation</li> </ul> <h3 id=recommendations>Recommendations<a class=headerlink href=#recommendations title="Permanent link">&para;</a></h3> <ol> <li><strong>Promote Worktree Pattern as Standard</strong></li> <li>Default approach for feature work</li> <li>Document in onboarding materials</li> <li>Add to workflow templates</li> <li> <p>Create helper scripts for common operations</p> </li> <li> <p><strong>Expand Fix-Agent Template Library</strong></p> </li> <li>Add more common patterns</li> <li>Document resolution strategies</li> <li>Create decision trees for pattern selection</li> <li> <p>Measure effectiveness metrics</p> </li> <li> <p><strong>Prioritize Message Reduction Features</strong></p> </li> <li>High user value (budget, complexity, consolidation)</li> <li>Clear implementation paths</li> <li>Measurable impact</li> <li> <p>Address frequent pain points</p> </li> <li> <p><strong>Create Parallel Execution Playbook</strong></p> </li> <li>Document lessons learned</li> <li>Provide concrete examples</li> <li>Include troubleshooting guide</li> <li>Share best practices</li> </ol> <h3 id=verification_1>Verification<a class=headerlink href=#verification_1 title="Permanent link">&para;</a></h3> <p><strong>All 13 Workflows Completed Successfully:</strong></p> <ul> <li> Issues created with clear requirements</li> <li> Branches created with descriptive names</li> <li> Code implemented following specifications</li> <li> Tests passing (where applicable)</li> <li> Philosophy compliance 9-10/10</li> <li> PRs created with complete documentation</li> <li> No cross-contamination between features</li> <li> Systematic conflict resolution applied</li> </ul> <p><strong>Performance Metrics:</strong></p> <ul> <li>Total time: ~4 hours for 13 features</li> <li>Average per feature: ~18 minutes</li> <li>Philosophy compliance: 9-10/10 average</li> <li>Success rate: 100%</li> </ul> <h3 id=next-steps_1>Next Steps<a class=headerlink href=#next-steps_1 title="Permanent link">&para;</a></h3> <ol> <li><strong>Review PRs and merge successful implementations</strong></li> <li><strong>Extract reusable patterns into documentation</strong></li> <li><strong>Update workflow with lessons learned</strong></li> <li><strong>Create templates for future parallel execution</strong></li> <li><strong>Document worktree management best practices</strong></li> <li><strong>Expand fix-agent template library</strong></li> <li><strong>Implement high-priority message reduction features</strong></li> </ol> <hr> <h2 id=sessionstart-and-stop-hooks-executing-twice-claude-code-bug-2025-11-21>SessionStart and Stop Hooks Executing Twice - Claude Code Bug (2025-11-21)<a class=headerlink href=#sessionstart-and-stop-hooks-executing-twice-claude-code-bug-2025-11-21 title="Permanent link">&para;</a></h2> <h3 id=discovery_2>Discovery<a class=headerlink href=#discovery_2 title="Permanent link">&para;</a></h3> <p>SessionStart and Stop hooks are executing <strong>twice per session</strong> due to a <strong>known Claude Code bug in the hook execution engine</strong> (#10871), NOT due to configuration errors. The issue affects all hook types and causes performance degradation and duplicate context injection.</p> <h3 id=context_2>Context<a class=headerlink href=#context_2 title="Permanent link">&para;</a></h3> <p>Investigation triggered by system reminder messages showing "SessionStart:startup hook success: Success" appearing twice. Initial hypothesis was incorrect configuration format, but deeper analysis revealed the configuration is correct per official schema.</p> <h3 id=root-cause_8>Root Cause<a class=headerlink href=#root-cause_8 title="Permanent link">&para;</a></h3> <p><strong>Claude Code Internal Bug</strong>: The hook execution engine spawns <strong>two separate Python processes</strong> for each hook invocation, regardless of configuration.</p> <p><strong>Current Configuration</strong> (CORRECT per schema):</p> <div class="language-json highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=nt>&quot;SessionStart&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>    </span><span class=nt>&quot;hooks&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w>  </span><span class=c1>//  Required by Claude Code schema</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>        </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;command&quot;</span><span class=p>,</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>        </span><span class=nt>&quot;command&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;$CLAUDE_PROJECT_DIR/.claude/tools/amplihack/hooks/session_start.py&quot;</span><span class=p>,</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=w>        </span><span class=nt>&quot;timeout&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>10000</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=w>    </span><span class=p>]</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=p>]</span>
</span></code></pre></div> <p><strong>Schema Requirement</strong>:</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=p>{</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>  </span><span class=s2>&quot;required&quot;</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;hooks&quot;</span><span class=p>],</span><span class=w>  </span><span class=c1>// The &quot;hooks&quot; wrapper is MANDATORY</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>  </span><span class=s2>&quot;additionalProperties&quot;</span><span class=o>:</span><span class=w> </span><span class=kc>false</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=p>}</span>
</span></code></pre></div> <h3 id=initial-hypothesis-was-wrong>Initial Hypothesis Was Wrong<a class=headerlink href=#initial-hypothesis-was-wrong title="Permanent link">&para;</a></h3> <p><strong>Initial theory</strong>: Extra <code>"hooks": []</code> wrapper was causing duplication.</p> <p><strong>Reality</strong>: The wrapper is <strong>required by Claude Code schema</strong>. Removing it causes validation errors:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>Settings validation failed:
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>- hooks.SessionStart.0.hooks: Expected array, but received undefined
</span></code></pre></div> <p><strong>Actual cause</strong>: Claude Code's hook execution engine has an internal bug that spawns two separate processes for each registered hook.</p> <h3 id=evidence>Evidence<a class=headerlink href=#evidence title="Permanent link">&para;</a></h3> <p><strong>Configuration Analysis</strong>:</p> <ul> <li>Only 1 SessionStart hook registered in settings.json</li> <li>No duplicate configurations found</li> <li>Schema validation confirms format is correct</li> <li><strong>Two separate Python processes</strong> spawn anyway (different PIDs)</li> </ul> <p><strong>From <code>~/.amplihack/.claude/runtime/logs/session_start.log</code></strong>:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>[2025-11-21T13:01:07.113446] INFO: session_start hook starting (Python 3.13.9)
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>[2025-11-21T13:01:07.113687] INFO: session_start hook starting (Python 3.13.9)
</span></code></pre></div> <p><strong>From <code>~/.amplihack/.claude/runtime/logs/stop.log</code></strong>:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>[2025-11-20T21:37:05.173846] INFO: stop hook starting (Python 3.13.9)
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>[2025-11-20T21:37:05.427256] INFO: stop hook starting (Python 3.13.9)
</span></code></pre></div> <p><strong>Pattern</strong>: All hooks (SessionStart, Stop, PostToolUse) show double execution with microsecond-level timing differences, indicating true parallel process spawning.</p> <h3 id=impact_2>Impact<a class=headerlink href=#impact_2 title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Area</th> <th>Effect</th> </tr> </thead> <tbody> <tr> <td><strong>Performance</strong></td> <td>2-4 seconds wasted per session (double process spawning)</td> </tr> <tr> <td><strong>Context Pollution</strong></td> <td>USER_PREFERENCES.md injected twice (~19KB duplicate)</td> </tr> <tr> <td><strong>Side Effects</strong></td> <td>File writes, metrics, logs all duplicated</td> </tr> <tr> <td><strong>Log Clarity</strong></td> <td>Every entry appears twice, making debugging confusing</td> </tr> <tr> <td><strong>Resource Usage</strong></td> <td>Double memory allocation, double I/O operations</td> </tr> </tbody> </table> <h3 id=solution_6>Solution<a class=headerlink href=#solution_6 title="Permanent link">&para;</a></h3> <p><strong>NO CODE FIX AVAILABLE</strong> - This is a Claude Code internal bug.</p> <p><strong>Workarounds</strong>:</p> <ol> <li>Accept the duplication (hooks are idempotent, safe but wasteful)</li> <li>Add process-level deduplication in hook_processor.py (complex)</li> <li>Wait for upstream Claude Code fix</li> </ol> <p><strong>Tracking</strong>: Claude Code GitHub Issue #10871 "Plugin-registered hooks are executed twice with different PIDs"</p> <h3 id=configuration-format-correct>Configuration Format (CORRECT)<a class=headerlink href=#configuration-format-correct title="Permanent link">&para;</a></h3> <p>Our configuration <strong>matches the official schema exactly</strong>:</p> <div class="language-json highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=nt>&quot;SessionStart&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=w>  </span><span class=p>{</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=w>    </span><span class=nt>&quot;hooks&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w>  </span><span class=c1>//  REQUIRED by schema</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>      </span><span class=p>{</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>        </span><span class=nt>&quot;type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;command&quot;</span><span class=p>,</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>        </span><span class=nt>&quot;command&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;$CLAUDE_PROJECT_DIR/.claude/tools/amplihack/hooks/session_start.py&quot;</span><span class=p>,</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>        </span><span class=nt>&quot;timeout&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>10000</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>    </span><span class=p>]</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=p>]</span>
</span></code></pre></div> <p><strong>Schema requirement</strong>:</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=s2>&quot;required&quot;</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;hooks&quot;</span><span class=p>],</span><span class=w>  </span><span class=c1>// The &quot;hooks&quot; wrapper is MANDATORY</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=s2>&quot;additionalProperties&quot;</span><span class=o>:</span><span class=w> </span><span class=kc>false</span>
</span></code></pre></div> <p>Attempting to remove the wrapper causes validation errors.</p> <h3 id=affected-hooks>Affected Hooks<a class=headerlink href=#affected-hooks title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Hook</th> <th>Status</th> <th>Root Cause</th> </tr> </thead> <tbody> <tr> <td><strong>SessionStart</strong></td> <td> Runs 2x</td> <td>Claude Code bug #10871</td> </tr> <tr> <td><strong>Stop</strong></td> <td> Runs 2x</td> <td>Claude Code bug #10871</td> </tr> <tr> <td><strong>PostToolUse</strong></td> <td> Runs 2x</td> <td>Claude Code bug #10871</td> </tr> <tr> <td>PreToolUse</td> <td> Unknown</td> <td>Likely affected</td> </tr> <tr> <td>PreCompact</td> <td> Unknown</td> <td>Likely affected</td> </tr> </tbody> </table> <h3 id=key-learnings_10>Key Learnings<a class=headerlink href=#key-learnings_10 title="Permanent link">&para;</a></h3> <ol> <li><strong>Configuration was correct all along</strong> - The <code>"hooks": []</code> wrapper is required by Claude Code schema</li> <li><strong>Schema validation prevents incorrect "fixes"</strong> - Attempted to remove wrapper, got validation errors</li> <li><strong>Log analysis reveals issues but not always root cause</strong> - Duplicate execution doesn't always mean duplicate configuration</li> <li><strong>Upstream bugs affect downstream projects</strong> - Known Claude Code bug (#10871) causes systematic duplication</li> <li><strong>Idempotent design saves us</strong> - Hooks are safe to run twice even though wasteful</li> <li><strong>Investigation workflow worked</strong> - Systematic analysis prevented incorrect fix from being deployed</li> </ol> <h3 id=no-action-required>No Action Required<a class=headerlink href=#no-action-required title="Permanent link">&para;</a></h3> <p><strong>Decision</strong>: Accept the duplication as a known limitation until Claude Code team fixes #10871.</p> <p><strong>Rationale</strong>:</p> <ul> <li>Configuration is correct per official schema</li> <li>No user-side fix available without breaking schema validation</li> <li>Hooks are idempotent (safe to run twice)</li> <li>Performance impact acceptable (~2 seconds per session)</li> <li>Workarounds (process-level dedup) would add significant complexity</li> </ul> <h3 id=monitoring>Monitoring<a class=headerlink href=#monitoring title="Permanent link">&para;</a></h3> <p>Track Claude Code GitHub for fix:</p> <ul> <li><strong>Issue #10871</strong>: "Plugin-registered hooks are executed twice with different PIDs"</li> <li><strong>Related</strong>: #3523 (hook duplication), #3465 (hooks fired twice from home dir)</li> </ul> <h3 id=verification_2>Verification<a class=headerlink href=#verification_2 title="Permanent link">&para;</a></h3> <p>Configuration correctness verified:</p> <ol> <li> Only 1 hook registered per event type</li> <li> Schema validation passes</li> <li> Format matches official Claude Code documentation</li> <li> Removing wrapper causes validation errors</li> <li> Both processes run to completion (not a race condition)</li> </ol> <h3 id=files-analyzed>Files Analyzed<a class=headerlink href=#files-analyzed title="Permanent link">&para;</a></h3> <ul> <li><code>~/.amplihack/.claude/settings.json</code> (1 SessionStart hook, 1 Stop hook)</li> <li><code>~/.amplihack/.claude/tools/amplihack/hooks/session_start.py</code> (hook implementation)</li> <li><code>~/.amplihack/.claude/runtime/logs/session_start.log</code> (execution evidence)</li> <li><code>~/.amplihack/.claude/runtime/logs/stop.log</code> (execution evidence)</li> <li>Claude Code schema (hook format requirements)</li> </ul> <hr> <h2 id=remember>Remember<a class=headerlink href=#remember title="Permanent link">&para;</a></h2> <ul> <li>Document immediately while context is fresh</li> <li>Include specific error messages and stack traces</li> <li>Show actual code that fixed the problem</li> <li>Think about broader implications</li> <li>Update PATTERNS.md when a discovery becomes a reusable pattern</li> </ul> <hr> <h2 id=expert-agent-creation-pattern-from-knowledge-bases-2025-10-18>Expert Agent Creation Pattern from Knowledge Bases (2025-10-18)<a class=headerlink href=#expert-agent-creation-pattern-from-knowledge-bases-2025-10-18 title="Permanent link">&para;</a></h2> <h3 id=discovery_3>Discovery<a class=headerlink href=#discovery_3 title="Permanent link">&para;</a></h3> <p>Successfully established reusable pattern for creating domain expert agents grounded in focused knowledge bases, achieving 10-20x learning speedup over traditional methods.</p> <h3 id=context_3>Context<a class=headerlink href=#context_3 title="Permanent link">&para;</a></h3> <p>After merging PR #931 (knowledge-builder refactoring), tested end-to-end workflow by creating two expert agents:</p> <ol> <li>Rust Programming Expert (memory safety, ownership)</li> <li>Azure Kubernetes Expert (production AKS deployments)</li> </ol> <h3 id=pattern-components>Pattern Components<a class=headerlink href=#pattern-components title="Permanent link">&para;</a></h3> <p><strong>1. Focused Knowledge Base Structure</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>.claude/data/{domain_name}/
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a> Knowledge.md          # 7-10 core concepts with Q&amp;A
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a> KeyInfo.md           # Executive summary, learning path
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a> HowToUseTheseFiles.md # Usage patterns, scenarios
</span></code></pre></div> <p><strong>2. Knowledge Base Content</strong></p> <ul> <li>Q&amp;A format (not documentation style)</li> <li>2-3 practical code examples per concept</li> <li>Actionable, not theoretical</li> <li>Focused on specific use case (not 270 generic questions)</li> </ul> <p><strong>3. Expert Agent Definition</strong></p> <div class="language-markdown highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>---
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>description: {Domain} expert with...
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>knowledge_base: .claude/data/{domain_name}/
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=gu>priority: high</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=gu>---</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=gh># {Domain} Expert Agent</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>[References knowledge base, defines competencies, usage patterns]
</span></code></pre></div> <h3 id=key-learnings_11>Key Learnings<a class=headerlink href=#key-learnings_11 title="Permanent link">&para;</a></h3> <ol> <li><strong>Focused Beats Breadth</strong></li> <li>7 focused concepts &gt; 270 generic questions</li> <li>Evidence: Rust implementation in 2 hours vs 20-40 hour traditional learning</li> <li> <p>Result: 10-20x speedup for project-specific domains</p> </li> <li> <p><strong>Q&amp;A Format Superior to Documentation</strong></p> </li> <li>Natural learning progression</li> <li>"Why" alongside "how"</li> <li>Easy to reference during implementation</li> <li> <p>Agent scored 9.5/10 in evaluation</p> </li> <li> <p><strong>Real Code Examples Essential</strong></p> </li> <li>Working examples 10x more valuable than explanations</li> <li>Can copy/adapt directly into implementation</li> <li> <p>Every concept needs 2-3 runnable examples</p> </li> <li> <p><strong>Performance Matters for Adoption</strong></p> </li> <li>30-minute generation time blocks practical use</li> <li>Focused manual creation: 20 minutes</li> <li><strong>Recommendation</strong>: Add <code>--depth</code> parameter (shallow/medium/deep)</li> </ol> <h3 id=files-created>Files Created<a class=headerlink href=#files-created title="Permanent link">&para;</a></h3> <p><strong>Expert Agents:</strong></p> <ul> <li><code>~/.amplihack/.claude/agents/amplihack/specialized/rust-programming-expert.md</code> (156 lines)</li> <li><code>~/.amplihack/.claude/agents/amplihack/specialized/azure-kubernetes-expert.md</code> (262 lines)</li> </ul> <p><strong>Rust Knowledge Base:</strong></p> <ul> <li><code>amplihack-logparse/.claude/data/rust_focused_for_log_parser/Knowledge.md</code> (218 lines)</li> <li><code>amplihack-logparse/.claude/data/rust_focused_for_log_parser/KeyInfo.md</code> (67 lines)</li> <li><code>amplihack-logparse/.claude/data/rust_focused_for_log_parser/HowToUseTheseFiles.md</code> (83 lines)</li> </ul> <p><strong>Azure AKS Knowledge Base:</strong></p> <ul> <li><code>~/.amplihack/.claude/data/azure_aks_expert/Knowledge.md</code> (986 lines, 30+ examples)</li> <li><code>~/.amplihack/.claude/data/azure_aks_expert/KeyInfo.md</code> (172 lines)</li> <li><code>~/.amplihack/.claude/data/azure_aks_expert/HowToUseTheseFiles.md</code> (275 lines)</li> </ul> <p><strong>Rust Log Parser (demonstrating knowledge application):</strong></p> <ul> <li><code>amplihack-logparse/src/types.rs</code> (91 lines) - Ownership</li> <li><code>amplihack-logparse/src/error.rs</code> (62 lines) - Error handling</li> <li><code>amplihack-logparse/src/parser/mod.rs</code> (165 lines) - Borrowing, Result</li> <li><code>amplihack-logparse/src/analyzer/mod.rs</code> (673 lines) - Traits</li> <li><code>amplihack-logparse/src/main.rs</code> (wired up CLI)</li> <li><strong>Test Status</strong>: 24/24 tests passing</li> </ul> <h3 id=verification_3>Verification<a class=headerlink href=#verification_3 title="Permanent link">&para;</a></h3> <p><strong>Rust Expert Agent Test:</strong></p> <ul> <li>Question: Borrow checker lifetime error</li> <li>Result: Correctly referenced Lifetimes section (Knowledge.md lines 52-72)</li> <li>Provided: Proper fix with lifetime annotations</li> <li>Score: 9.5/10</li> </ul> <p><strong>Azure AKS Expert Agent Test:</strong></p> <ul> <li>Question: Production deployment with HTTPS, autoscaling, Key Vault, monitoring</li> <li>Result: Correctly referenced 4 knowledge base sections</li> <li>Provided: Complete Azure CLI commands and YAML manifests</li> <li>Score: PASS (production-ready)</li> </ul> <h3 id=recommendations_1>Recommendations<a class=headerlink href=#recommendations_1 title="Permanent link">&para;</a></h3> <ol> <li><strong>Optimize knowledge-builder performance</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>/knowledge-builder<span class=w> </span><span class=s2>&quot;topic&quot;</span><span class=w> </span>--depth<span class=w> </span>shallow<span class=w>    </span><span class=c1># 10 questions, 2-3 min</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>/knowledge-builder<span class=w> </span><span class=s2>&quot;topic&quot;</span><span class=w> </span>--depth<span class=w> </span>medium<span class=w>     </span><span class=c1># 30 questions, 5-10 min</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>/knowledge-builder<span class=w> </span><span class=s2>&quot;topic&quot;</span><span class=w> </span>--depth<span class=w> </span>deep<span class=w>       </span><span class=c1># 270 questions, 30+ min</span>
</span></code></pre></div> <ol> <li><strong>Add focus parameter</strong></li> </ol> <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>/knowledge-builder<span class=w> </span><span class=s2>&quot;Rust&quot;</span><span class=w> </span>--focus<span class=w> </span><span class=s2>&quot;ownership,borrowing&quot;</span>
</span></code></pre></div> <ol> <li><strong>Create more domain experts using this pattern</strong></li> <li>AWS EKS (similar to AKS)</li> <li>Terraform (infrastructure as code)</li> <li>PostgreSQL (database operations)</li> <li>React + TypeScript (frontend development)</li> </ol> <h3 id=impact_3>Impact<a class=headerlink href=#impact_3 title="Permanent link">&para;</a></h3> <p><strong>Pattern Reusability</strong>: Can be applied to any technical domain <strong>Learning Speedup</strong>: 10-20x faster for project-specific learning <strong>Agent Quality</strong>: Both agents production-ready, comprehensively tested <strong>Cost-Benefit</strong>: ~1 hour per agent after pattern established</p> <h3 id=related-issuesprs>Related Issues/PRs<a class=headerlink href=#related-issuesprs title="Permanent link">&para;</a></h3> <ul> <li><strong>Issue</strong>: #930</li> <li><strong>PR</strong>: #931 (knowledge-builder refactoring, MERGED)</li> <li><strong>PR</strong>: #941 (auto mode fix, MERGED)</li> </ul> <hr> <h2 id=neo4j-container-port-mismatch-detection-bug-2025-11-08>Neo4j Container Port Mismatch Detection Bug (2025-11-08)<a class=headerlink href=#neo4j-container-port-mismatch-detection-bug-2025-11-08 title="Permanent link">&para;</a></h2> <h3 id=issue_2>Issue<a class=headerlink href=#issue_2 title="Permanent link">&para;</a></h3> <p>Amplihack startup would fail with container name conflicts when starting in a different project directory than where the Neo4j container was originally created, even though a container with the expected name already existed:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a> Our Neo4j container found on ports 7787/7774
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>Query failed... localhost:7688 (Connection refused)
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>Failed to create container... Conflict... already in use
</span></code></pre></div> <h3 id=root-cause_9>Root Cause<a class=headerlink href=#root-cause_9 title="Permanent link">&para;</a></h3> <p><strong>Logic Flaw in Port Detection</strong>: The <code>is_our_neo4j_container()</code> function checked if a container with the expected NAME existed, but didn't retrieve the ACTUAL ports the container was using.</p> <p><strong>Exact Bug Location</strong>: <code>src/amplihack/memory/neo4j/port_manager.py:147-149</code></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1># BROKEN - Assumes container is on ports from .env</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=k>if</span> <span class=n>is_our_neo4j_container</span><span class=p>():</span>  <span class=c1># Only checks name, doesn&#39;t get ports!</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>    <span class=n>messages</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot; Our Neo4j container found on ports </span><span class=si>{</span><span class=n>bolt_port</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>http_port</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>    <span class=k>return</span> <span class=n>bolt_port</span><span class=p>,</span> <span class=n>http_port</span><span class=p>,</span> <span class=n>messages</span>  <span class=c1># Returns WRONG ports from .env</span>
</span></code></pre></div> <p><strong>Error Sequence</strong>:</p> <ol> <li>Container exists on ports 7787/7774 (actual)</li> <li><code>.env</code> in new directory has port 7688 (wrong)</li> <li>Code detects container exists by name </li> <li>Code assumes container is on 7688 (from <code>.env</code>) </li> <li>Connection to 7688 fails (nothing listening)</li> <li>Code tries to create new container (name conflict)</li> </ol> <h3 id=solution_7>Solution<a class=headerlink href=#solution_7 title="Permanent link">&para;</a></h3> <p><strong>Added <code>get_container_ports()</code> function</strong> that queries actual container ports using <code>docker port</code>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=k>def</span><span class=w> </span><span class=nf>get_container_ports</span><span class=p>(</span><span class=n>container_name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;amplihack-neo4j&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]]:</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get actual ports from running Neo4j container.</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=sd>    Uses `docker port` command to inspect actual port mappings,</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=sd>    not what .env file claims.</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=sd>    Returns:</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=sd>        (bolt_port, http_port) if container running with ports, None otherwise</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>        <span class=p>[</span><span class=s2>&quot;docker&quot;</span><span class=p>,</span> <span class=s2>&quot;port&quot;</span><span class=p>,</span> <span class=n>container_name</span><span class=p>],</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>        <span class=n>capture_output</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>        <span class=n>timeout</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a>        <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>    <span class=p>)</span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a>    <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>returncode</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-21-19><a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a>
</span><span id=__span-21-20><a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a>    <span class=c1># Parse output: &quot;7687/tcp -&gt; 0.0.0.0:7787&quot;</span>
</span><span id=__span-21-21><a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a>    <span class=c1># Extract actual host ports from both ports</span>
</span><span id=__span-21-22><a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a>    <span class=c1># ...</span>
</span><span id=__span-21-23><a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a>    <span class=k>return</span> <span class=n>bolt_port</span><span class=p>,</span> <span class=n>http_port</span>
</span></code></pre></div> <p><strong>Updated <code>resolve_port_conflicts()</code></strong> to use actual ports:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># FIXED - Use actual container ports, not .env ports</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=n>container_ports</span> <span class=o>=</span> <span class=n>get_container_ports</span><span class=p>(</span><span class=s2>&quot;amplihack-neo4j&quot;</span><span class=p>)</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=k>if</span> <span class=n>container_ports</span><span class=p>:</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>    <span class=n>actual_bolt</span><span class=p>,</span> <span class=n>actual_http</span> <span class=o>=</span> <span class=n>container_ports</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>    <span class=n>messages</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot; Our Neo4j container found on ports </span><span class=si>{</span><span class=n>actual_bolt</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>actual_http</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>    <span class=c1># Update .env if ports don&#39;t match</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>    <span class=k>if</span> <span class=p>(</span><span class=n>actual_bolt</span> <span class=o>!=</span> <span class=n>bolt_port</span> <span class=ow>or</span> <span class=n>actual_http</span> <span class=o>!=</span> <span class=n>http_port</span><span class=p>)</span> <span class=ow>and</span> <span class=n>project_root</span><span class=p>:</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>        <span class=n>_update_env_ports</span><span class=p>(</span><span class=n>project_root</span><span class=p>,</span> <span class=n>actual_bolt</span><span class=p>,</span> <span class=n>actual_http</span><span class=p>)</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>        <span class=n>messages</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot; Updated .env to match container ports&quot;</span><span class=p>)</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>    <span class=k>return</span> <span class=n>actual_bolt</span><span class=p>,</span> <span class=n>actual_http</span><span class=p>,</span> <span class=n>messages</span>
</span></code></pre></div> <h3 id=key-learnings_12>Key Learnings<a class=headerlink href=#key-learnings_12 title="Permanent link">&para;</a></h3> <ol> <li><strong>Container Detection  Port Detection</strong> - Knowing a container exists doesn't tell you what ports it's using</li> <li><strong><code>.env</code> Files Can Lie</strong> - Configuration files can become stale, always verify actual runtime state</li> <li><strong>Docker Port Command is Canonical</strong> - <code>docker port &lt;container&gt;</code> returns actual mappings, not configured values</li> <li><strong>Self-Healing Behavior</strong> - Automatically updating <code>.env</code> to match reality prevents future failures</li> <li><strong>Challenge User Assumptions</strong> - The user was right that stopping the container wasn't the real fix - the port mismatch was the actual issue</li> </ol> <h3 id=prevention_4>Prevention<a class=headerlink href=#prevention_4 title="Permanent link">&para;</a></h3> <p><strong>Before this fix:</strong></p> <ul> <li>Starting amplihack in multiple directories would fail with container conflicts</li> <li>Users had to manually sync <code>.env</code> files across projects</li> <li>No automatic detection of port mismatches</li> </ul> <p><strong>After this fix:</strong></p> <ul> <li>Amplihack automatically detects actual container ports</li> <li><code>.env</code> files auto-update to match reality</li> <li>Can start amplihack in any directory, will reuse existing container</li> <li>Self-healing behavior prevents stale configuration issues</li> </ul> <h3 id=testing>Testing<a class=headerlink href=#testing title="Permanent link">&para;</a></h3> <p><strong>Comprehensive test coverage (29 tests, all passing)</strong>:</p> <ul> <li>Docker port output parsing (12 tests)</li> <li>Port conflict resolution (5 tests)</li> <li>Port availability detection (4 tests)</li> <li>Edge cases (5 tests)</li> <li>Integration scenarios (3 tests)</li> </ul> <p><strong>Test Location</strong>: <code>tests/unit/memory/neo4j/test_port_manager.py</code></p> <h3 id=files-modified>Files Modified<a class=headerlink href=#files-modified title="Permanent link">&para;</a></h3> <ul> <li><code>src/amplihack/memory/neo4j/port_manager.py</code>: Added <code>get_container_ports()</code>, updated <code>resolve_port_conflicts()</code></li> <li><code>tests/unit/memory/neo4j/test_port_manager.py</code>: Added comprehensive test suite (29 tests)</li> </ul> <h3 id=verification_4>Verification<a class=headerlink href=#verification_4 title="Permanent link">&para;</a></h3> <p><strong>Original Error Reproduced</strong>:  <strong>Fix Applied</strong>:  <strong>All Tests Passing</strong>:  29/29 <strong>Self-Healing Confirmed</strong>:  <code>.env</code> updates automatically</p> <h3 id=pattern-recognition_1>Pattern Recognition<a class=headerlink href=#pattern-recognition_1 title="Permanent link">&para;</a></h3> <p><strong>Trigger Signs of Port Mismatch Issues</strong>:</p> <ul> <li>"Container found" but connection fails</li> <li>"Conflict" errors when creating containers</li> <li>Port numbers in error messages don't match expected ports</li> <li>Working in different directories with shared container</li> </ul> <p><strong>Debugging Approach</strong>:</p> <ol> <li>Check if container actually exists (<code>docker ps</code>)</li> <li>Check what ports container is actually using (<code>docker port &lt;name&gt;</code>)</li> <li>Check what ports configuration expects (<code>.env</code>, config files)</li> <li>Fix: Use actual ports, not configured ports</li> </ol> <h3 id=philosophy-alignment>Philosophy Alignment<a class=headerlink href=#philosophy-alignment title="Permanent link">&para;</a></h3> <ul> <li><strong>Ruthless Simplicity</strong>: Single function solves the problem, minimal changes</li> <li><strong>Self-Healing</strong>: System automatically corrects stale configuration</li> <li><strong>Zero-BS</strong>: No workarounds, addresses root cause directly</li> <li><strong>Reality Over Configuration</strong>: Trust Docker's actual state, not config files</li> </ul> <hr> <h2 id=power-steering-mode-branch-divergence-2025-11-16>Power Steering Mode Branch Divergence (2025-11-16)<a class=headerlink href=#power-steering-mode-branch-divergence-2025-11-16 title="Permanent link">&para;</a></h2> <h3 id=problem_7>Problem<a class=headerlink href=#problem_7 title="Permanent link">&para;</a></h3> <p>Power steering feature not activating - appeared disabled.</p> <h3 id=root-cause_10>Root Cause<a class=headerlink href=#root-cause_10 title="Permanent link">&para;</a></h3> <p><strong>Feature was missing from branch entirely</strong>. Branch diverged from main BEFORE power steering was merged.</p> <h3 id=solution_8>Solution<a class=headerlink href=#solution_8 title="Permanent link">&para;</a></h3> <p>Sync branch with main: <code>git rebase origin/main</code></p> <h3 id=key-learnings_13>Key Learnings<a class=headerlink href=#key-learnings_13 title="Permanent link">&para;</a></h3> <p>"Feature not working" can mean "Feature not present". Always check git history: <code>git log HEAD...origin/main</code></p> <hr> <h2 id=mandatory-end-to-end-testing-pattern-2025-11-10>Mandatory End-to-End Testing Pattern (2025-11-10)<a class=headerlink href=#mandatory-end-to-end-testing-pattern-2025-11-10 title="Permanent link">&para;</a></h2> <h3 id=problem_8>Problem<a class=headerlink href=#problem_8 title="Permanent link">&para;</a></h3> <p>Code committed after unit tests and reviews but missing real user experience validation.</p> <h3 id=solution_9>Solution<a class=headerlink href=#solution_9 title="Permanent link">&para;</a></h3> <p><strong>ALWAYS test with <code>uvx --from &lt;branch&gt;</code> before committing</strong>:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>uvx<span class=w> </span>--from<span class=w> </span>git+https://github.com/org/repo@branch<span class=w> </span>package<span class=w> </span><span class=nb>command</span>
</span></code></pre></div> <p>This verifies: package installation, dependency resolution, actual user workflow, error messages, config updates.</p> <h3 id=key-learnings_14>Key Learnings<a class=headerlink href=#key-learnings_14 title="Permanent link">&para;</a></h3> <p>Testing hierarchy (all required):</p> <ol> <li>Unit tests</li> <li>Integration tests</li> <li>Code reviews</li> <li><strong>End-to-end user experience test</strong> (MANDATORY BEFORE COMMIT)</li> </ol> <hr> <h2 id=neo4j-container-port-mismatch-bug-2025-11-08>Neo4j Container Port Mismatch Bug (2025-11-08)<a class=headerlink href=#neo4j-container-port-mismatch-bug-2025-11-08 title="Permanent link">&para;</a></h2> <h3 id=problem_9>Problem<a class=headerlink href=#problem_9 title="Permanent link">&para;</a></h3> <p>Startup fails with container conflicts when starting in different directory than where Neo4j container was created.</p> <h3 id=root-cause_11>Root Cause<a class=headerlink href=#root-cause_11 title="Permanent link">&para;</a></h3> <p><code>is_our_neo4j_container()</code> checked container NAME but not ACTUAL ports. <code>.env</code> can become stale.</p> <h3 id=solution_10>Solution<a class=headerlink href=#solution_10 title="Permanent link">&para;</a></h3> <p>Added <code>get_container_ports()</code> using <code>docker port</code> to query actual ports. Auto-update <code>.env</code> to match reality.</p> <h3 id=key-learnings_15>Key Learnings<a class=headerlink href=#key-learnings_15 title="Permanent link">&para;</a></h3> <p>Container Detection != Port Detection. <code>.env</code> files can lie. Docker port command is canonical.</p> <hr> <h2 id=parallel-reflection-workstream-execution-2025-11-05>Parallel Reflection Workstream Execution (2025-11-05)<a class=headerlink href=#parallel-reflection-workstream-execution-2025-11-05 title="Permanent link">&para;</a></h2> <h3 id=context_4>Context<a class=headerlink href=#context_4 title="Permanent link">&para;</a></h3> <p>Successfully executed 13 parallel full-workflow tasks simultaneously using worktree isolation.</p> <h3 id=key-metrics>Key Metrics<a class=headerlink href=#key-metrics title="Permanent link">&para;</a></h3> <ul> <li>13 issues created (#1089-#1101)</li> <li>13 PRs with 9-10/10 philosophy compliance</li> <li>100% success rate</li> <li>~18 minutes per feature average</li> </ul> <h3 id=patterns-that-worked>Patterns That Worked<a class=headerlink href=#patterns-that-worked title="Permanent link">&para;</a></h3> <ol> <li><strong>Worktree Isolation</strong>: Each feature in separate worktree</li> <li><strong>Agent Specialization</strong>: prompt-writer  architect  builder  reviewer</li> <li><strong>Cherry-Pick for Divergent Branches</strong>: Better than rebase for parallel work</li> <li><strong>Documentation-First</strong>: Templates reduce decision overhead</li> </ol> <h3 id=key-learnings_16>Key Learnings<a class=headerlink href=#key-learnings_16 title="Permanent link">&para;</a></h3> <p>Parallel execution scales well. Worktrees provide perfect isolation. Philosophy compliance maintained at scale.</p> <hr> <h2 id=pattern-applicability-analysis-framework-2025-10-20_1>Pattern Applicability Analysis Framework (2025-10-20)<a class=headerlink href=#pattern-applicability-analysis-framework-2025-10-20_1 title="Permanent link">&para;</a></h2> <h3 id=context_5>Context<a class=headerlink href=#context_5 title="Permanent link">&para;</a></h3> <p>Evaluated PBZFT vs N-Version Programming. PBZFT would be 6-9x more complex with zero benefit.</p> <h3 id=six-meta-patterns-identified>Six Meta-Patterns Identified<a class=headerlink href=#six-meta-patterns-identified title="Permanent link">&para;</a></h3> <ol> <li><strong>Threat Model Precision</strong>: Match defense to actual failure mode</li> <li><strong>Voting vs Expert Judgment</strong>: Expert review for quality, voting for adversarial consensus</li> <li><strong>Distributed Systems Applicability Test</strong>: Most patterns don't apply to AI (different trust model)</li> <li><strong>Complexity-Benefit Ratio</strong>: Require &gt;3.0 ratio to justify complexity</li> <li><strong>Domain Appropriateness Check</strong>: Best practices are domain-specific</li> <li><strong>Diversity as Error Reduction</strong>: Independent implementations reduce correlated errors</li> </ol> <h3 id=key-learnings_17>Key Learnings<a class=headerlink href=#key-learnings_17 title="Permanent link">&para;</a></h3> <ul> <li>Threat model mismatch is primary source of inappropriate pattern adoption</li> <li>Distributed systems patterns rarely map to AI systems</li> <li>Always verify failure modes match before importing patterns</li> </ul> <p><strong>Note</strong>: Consider promoting to PATTERNS.md if framework used 3+ times.</p> <hr> <h2 id=socratic-questioning-pattern-2025-10-18>Socratic Questioning Pattern (2025-10-18)<a class=headerlink href=#socratic-questioning-pattern-2025-10-18 title="Permanent link">&para;</a></h2> <h3 id=context_6>Context<a class=headerlink href=#context_6 title="Permanent link">&para;</a></h3> <p>Developed effective method for deep, probing questions in knowledge-builder scenarios.</p> <h3 id=three-dimensional-attack-strategy>Three-Dimensional Attack Strategy<a class=headerlink href=#three-dimensional-attack-strategy title="Permanent link">&para;</a></h3> <ol> <li><strong>Empirical</strong>: Challenge with observable evidence</li> <li><strong>Computational</strong>: Probe tractability and complexity</li> <li><strong>Formal Mathematical</strong>: Demand precise relationships</li> </ol> <h3 id=usage-context_1>Usage Context<a class=headerlink href=#usage-context_1 title="Permanent link">&para;</a></h3> <ul> <li>When: Knowledge exploration, challenging claims, surfacing assumptions</li> <li>When NOT: Simple factual questions, time-sensitive decisions</li> </ul> <p><strong>Status</strong>: 1 successful usage. Needs 2-3 more before promoting to PATTERNS.md.</p> <hr> <h2 id=expert-agent-creation-pattern-2025-10-18>Expert Agent Creation Pattern (2025-10-18)<a class=headerlink href=#expert-agent-creation-pattern-2025-10-18 title="Permanent link">&para;</a></h2> <h3 id=context_7>Context<a class=headerlink href=#context_7 title="Permanent link">&para;</a></h3> <p>Created Rust and Azure Kubernetes expert agents with 10-20x learning speedup.</p> <h3 id=pattern-components_1>Pattern Components<a class=headerlink href=#pattern-components_1 title="Permanent link">&para;</a></h3> <ol> <li><strong>Focused Knowledge Base</strong>: 7-10 core concepts in Q&amp;A format</li> <li><strong>Structure</strong>: <code>Knowledge.md</code>, <code>KeyInfo.md</code>, <code>HowToUseTheseFiles.md</code></li> <li><strong>Expert Agent</strong>: References knowledge base, defines competencies</li> </ol> <h3 id=key-learnings_18>Key Learnings<a class=headerlink href=#key-learnings_18 title="Permanent link">&para;</a></h3> <ul> <li>Focused beats breadth (7 concepts &gt; 270 generic questions)</li> <li>Q&amp;A format superior to documentation style</li> <li>Real code examples are essential (2-3 per concept)</li> </ul> <p><strong>Note</strong>: Consider promoting to PATTERNS.md if used 3+ times.</p> <hr> <h2 id=remember_1>Remember<a class=headerlink href=#remember_1 title="Permanent link">&para;</a></h2> <ul> <li>Document immediately while context is fresh</li> <li>Include specific error messages</li> <li>Show code that fixed the problem</li> <li>Update PATTERNS.md when a discovery becomes reusable</li> <li>Archive entries older than 3 months to DISCOVERIES_ARCHIVE.md</li> </ul> <h2 id=2025-12-01-stop-gates-break-sonnet-help-opus-model-specific-prompt-behavior-issue-1755>2025-12-01: STOP Gates Break Sonnet, Help Opus - Model-Specific Prompt Behavior (Issue #1755)<a class=headerlink href=#2025-12-01-stop-gates-break-sonnet-help-opus-model-specific-prompt-behavior-issue-1755 title="Permanent link">&para;</a></h2> <p><strong>Context</strong>: Testing CLAUDE.md modifications across both Opus and Sonnet models revealed same text produces opposite outcomes.</p> <p><strong>Problem</strong>: STOP validation gates have model-specific effects:</p> <ul> <li><strong>Opus 4.5</strong>: STOP gates help (20/22  22/22 steps) </li> <li><strong>Sonnet 4.5</strong>: STOP gates break (22/22  8/22 steps) </li> <li><strong>Root cause</strong>: Different models interpret validation language differently</li> </ul> <p><strong>Solution</strong>: V2 (No STOP Gates) - Remove validation checkpoints while keeping workflow structure</p> <p><strong>Results</strong> (6/8 benchmarks complete, 75%):</p> <p>Sonnet V2:</p> <ul> <li> MEDIUM: 24.8m, $5.47, 22/22 steps (-16% cost improvement)</li> <li> HIGH: 21.7m, $4.92, 22 turns (-12% duration vs MEDIUM - negative scaling!)</li> </ul> <p>Opus V2:</p> <ul> <li> MEDIUM: 61.5m, $56.86, ~20/22 steps (-12% duration, -21% cost improvement!)</li> <li> HIGH: Testing (~4.5 hours remaining)</li> </ul> <p><strong>Key Insights</strong>:</p> <ol> <li><strong>Multi-Model Testing Required</strong>: Same prompt can help one model while breaking another</li> <li><strong>STOP Gate Paradox</strong>: Removing validation gates IMPROVES performance (12-21% cost reduction)</li> <li><strong>Negative Complexity Scaling</strong>: V2 HIGH faster than MEDIUM for well-defined tasks (task clarity &gt; complexity)</li> <li><strong>Universal Optimization</strong>: V2 improves BOTH models, not just fixes one</li> <li><strong>High-Salience Language Risky</strong>: "STOP", "MUST", ALL CAPS trigger different model responses</li> </ol> <p><strong>Impact</strong>:</p> <ul> <li>Fixes Sonnet degradation completely (8/22  22/22)</li> <li>Improves Sonnet performance (-12% to -16%)</li> <li>Improves Opus performance (-12% to -21%)</li> <li><span class=arithmatex>\(20K-\)</span>406K annual savings (moderate: $81K/year)</li> <li>Universal solution (single CLAUDE.md for both models)</li> </ul> <p><strong>Implementation</strong>: V2 deployed when Opus HIGH validates (expected)</p> <p><strong>Related</strong>: #1755, #1703, #1687</p> <p><strong>Pattern Identified</strong>: Validation checkpoints can backfire - use flow language instead of interruption language</p> <p><strong>Lesson</strong>: Always validate AI guidance changes empirically with ALL target models before deploying</p> <hr> <h2 id=mandatory-user-testing-validates-value-2025-12-02>Mandatory User Testing Validates Its Own Value<a class=headerlink href=#mandatory-user-testing-validates-value-2025-12-02 title="Permanent link">&para;</a></h2> <p><strong>Date</strong>: 2025-12-02 <strong>Context</strong>: Implementing Parallel Task Orchestrator (Issue #1783, PR #1784) <strong>Impact</strong>: HIGH - Validates mandatory testing requirement, found production-blocking bug</p> <h3 id=problem_10>Problem<a class=headerlink href=#problem_10 title="Permanent link">&para;</a></h3> <p>Unit tests can achieve high coverage (86%) and 100% pass rate while missing critical real-world bugs.</p> <h3 id=discovery_4>Discovery<a class=headerlink href=#discovery_4 title="Permanent link">&para;</a></h3> <p>Mandatory user testing (USER_PREFERENCES.md requirement) caught a <strong>production-blocking bug</strong> that 110 passing unit tests missed:</p> <p><strong>Bug</strong>: <code>SubIssue</code> dataclass not hashable, but <code>OrchestrationConfig</code> uses <code>set()</code> for deduplication</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># This passed all unit tests but fails in real usage:</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=n>config</span> <span class=o>=</span> <span class=n>OrchestrationConfig</span><span class=p>(</span><span class=n>sub_issues</span><span class=o>=</span><span class=p>[</span><span class=o>...</span><span class=p>])</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=c1># TypeError: unhashable type: &#39;SubIssue&#39;</span>
</span></code></pre></div> <h3 id=how-it-was-missed>How It Was Missed<a class=headerlink href=#how-it-was-missed title="Permanent link">&para;</a></h3> <p><strong>Unit Tests</strong> (110/110 passing):</p> <ul> <li>Mocked all <code>SubIssue</code> creation</li> <li>Never tested real deduplication path</li> <li>Assumed API worked without instantiation</li> </ul> <p><strong>User Testing</strong> (mandatory requirement):</p> <ul> <li>Tried actual config creation</li> <li><strong>Bug discovered in &lt;2 minutes</strong></li> <li>Immediate TypeError on first real use</li> </ul> <h3 id=fix>Fix<a class=headerlink href=#fix title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># Before</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=nd>@dataclass</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=k>class</span><span class=w> </span><span class=nc>SubIssue</span><span class=p>:</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>    <span class=n>labels</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>)</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=c1># After</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=nd>@dataclass</span><span class=p>(</span><span class=n>frozen</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=k>class</span><span class=w> </span><span class=nc>SubIssue</span><span class=p>:</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>    <span class=n>labels</span><span class=p>:</span> <span class=nb>tuple</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>tuple</span><span class=p>)</span>
</span></code></pre></div> <h3 id=validation>Validation<a class=headerlink href=#validation title="Permanent link">&para;</a></h3> <p><strong>Test Results After Fix</strong>:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a> Config creation works
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a> Deduplication works (3 items  2 unique)
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a> Orchestrator instantiation works
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a> Status API functional
</span></code></pre></div> <h3 id=key-insights>Key Insights<a class=headerlink href=#key-insights title="Permanent link">&para;</a></h3> <ol> <li><strong>High test coverage  Real-world readiness</strong></li> <li>86% coverage, 110/110 tests, still had production blocker</li> <li> <p>Mocks hide integration issues</p> </li> <li> <p><strong>User testing finds different bugs</strong></p> </li> <li>Unit tests validate component logic</li> <li>User tests validate actual workflows</li> <li> <p>Both are necessary</p> </li> <li> <p><strong>Mandatory requirement justified</strong></p> </li> <li>Without user testing, would've shipped broken code</li> <li>CI wouldn't catch this (unit tests pass)</li> <li> <p>First user would've hit TypeError</p> </li> <li> <p><strong>Time investment worthwhile</strong></p> </li> <li>&lt;5 minutes of user testing</li> <li>Found bug that could've cost hours of debugging</li> <li>Prevented embarrassing production failure</li> </ol> <h3 id=implementation>Implementation<a class=headerlink href=#implementation title="Permanent link">&para;</a></h3> <p><strong>Mandatory User Testing Pattern</strong>:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># Test like a user would</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>python<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;from module import Class; obj = Class(...)&quot;</span><span class=w>  </span><span class=c1># Real instantiation</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=nv>config</span><span class=w> </span><span class=o>=</span><span class=w> </span>RealConfig<span class=o>(</span>real_data<span class=o>)</span><span class=w>  </span><span class=c1># No mocks</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=nv>result</span><span class=w> </span><span class=o>=</span><span class=w> </span>api.actual_method<span class=o>()</span><span class=w>  </span><span class=c1># Real workflow</span>
</span></code></pre></div> <p><strong>NOT sufficient</strong>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1># Unit test approach (can miss real issues)</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=nd>@patch</span><span class=p>(</span><span class=s2>&quot;module.Class&quot;</span><span class=p>)</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=k>def</span><span class=w> </span><span class=nf>test_with_mock</span><span class=p>(</span><span class=n>mock_class</span><span class=p>):</span>  <span class=c1># Never tests real instantiation</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>    <span class=o>...</span>
</span></code></pre></div> <h3 id=lessons-learned>Lessons Learned<a class=headerlink href=#lessons-learned title="Permanent link">&para;</a></h3> <ol> <li><strong>Always test like a user</strong> - No mocks, real instantiation, actual workflows</li> <li><strong>High coverage isn't enough</strong> - Need real usage validation</li> <li><strong>Mocks hide bugs</strong> - Integration issues invisible to mocked tests</li> <li><strong>User requirements are wise</strong> - This explicit requirement saved us from shipping broken code</li> </ol> <h3 id=related>Related<a class=headerlink href=#related title="Permanent link">&para;</a></h3> <ul> <li>Issue #1783: Parallel Task Orchestrator</li> <li>PR #1784: Implementation</li> <li>USER_PREFERENCES.md: Mandatory E2E testing requirement</li> <li>Commit dc90b350: Hashability fix</li> </ul> <h3 id=recommendation>Recommendation<a class=headerlink href=#recommendation title="Permanent link">&para;</a></h3> <p><strong>ENFORCE mandatory user testing</strong> for ALL features:</p> <ul> <li>Test with <code>uvx --from git+...</code> (no local state)</li> <li>Try actual user workflows (no mocks)</li> <li>Verify error messages and UX</li> <li>Document test results in PR</li> </ul> <p>This discovery <strong>validates the user's explicit requirement</strong> - mandatory user testing prevents production failures that unit tests miss.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="January 23, 2026 17:11:42 UTC"><span class=timeago datetime=2026-01-23T17:11:42+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="January 23, 2026 17:11:42 UTC">2026-01-23</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="September 16, 2025 21:52:01 UTC"><span class=timeago datetime=2025-09-16T21:52:01+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="September 16, 2025 21:52:01 UTC">2025-09-16</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve by opening an issue. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 amplihack contributors </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/rysweet/amplihack target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "search.share", "toc.follow", "toc.integrate", "content.code.copy", "content.code.annotate", "content.action.edit", "content.action.view"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../../../js/timeago.min.js></script> <script src=../../../js/timeago_mkdocs_material.js></script> <script src=../../../javascripts/extra.js></script> <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>